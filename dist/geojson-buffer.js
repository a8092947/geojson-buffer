!function(a,b){typeof exports==='object'&&typeof module!=='undefined'?b(exports):typeof define==='function'&&define.amd?define(['exports'],b):(b((a.geojsonBuffer={})))}(this,(function(c){'use strict';function e(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function f(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value" in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}function g(a,b,c){b&&f(a.prototype,b);c&&f(a,c);return a}function h(a,b,c){var d=Math.sqrt((a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y)),e=a.x+c*(b.y-a.y)/d,f=b.x+c*(b.y-a.y)/d,g=a.y+c*(a.x-b.x)/d,h=b.y+c*(a.x-b.x)/d;return[new z([e,g]),new z([f,h])]}function j(a,b,c,d,e,f,g,h){var i,j,k,l,m,n=[null,null];i=(h-f)*(c-a)-(g-e)*(d-b);if(i===0)return !1;j=b-f;k=a-e;l=(g-e)*j-(h-f)*k;m=(c-a)*j-(d-b)*k;j=l/i;k=m/i;n[0]=a+j*(c-a);n[1]=b+j*(d-b);return new z(n)}function k(a){return a*180/Math.PI}function l(a){return a*Math.PI/180}function m(a){var b=a%360;b<0&&(b+=360);return b}var o=6371008.8,q={centimeters:o*100,centimetres:o*100,degrees:180/Math.PI,feet:o*3.28084,inches:o*39.370,kilometers:o/1000,kilometres:o/1000,meters:o,metres:o,miles:o/1609.344,millimeters:o*1000,millimetres:o*1000,nauticalmiles:o/1852,radians:1,yards:o/1.0936};function r(a,b){var c=q[b||'kilometers'];return a/c}function s(a,b){b===null&&(b='kilometers');return k(r(a,b))}function u(a,b){var c=a.radiansY-b.radiansY,d=a.radiansX-b.radiansX,e=a.radiansY,f=b.radiansY,g=Math.pow(Math.sin(c/2),2)+Math.pow(Math.sin(d/2),2)*Math.cos(e)*Math.cos(f);return 2*Math.atan2(Math.sqrt(g),Math.sqrt(1-g))}function w(a,b){var c=l(a.x),d=l(b.x),e=l(a.y),f=l(b.y),g=Math.sin(d-c)*Math.cos(f),h=Math.cos(e)*Math.sin(f)-Math.sin(e)*Math.cos(f)*Math.cos(d-c);return k(Math.atan2(g,h))}var z=function(){function a(b){e(this,a);this.x=b[0];this.y=b[1];this.radiansX=null;this.radiansY=null;this.calcRadiansForCoords();this.prevPoint=null;this.bearingPrevPoint=null;this.nextPoint=null;this.bearingNextPoint=null;this.angleBetweenPoints=null;this.isConcave=null}g(a,[{key:"calcRadiansForCoords",value:function a(){this.radiansX=l(this.x);this.radiansY=l(this.y)}},{key:"calcuateAnglesBetweeenPoints",value:function a(){this.bearingPrevPoint=w(this,this.prevPoint);this.bearingNextPoint=w(this,this.nextPoint);this.angleBetweenPoints=m(m(this.bearingNextPoint)-m(this.bearingPrevPoint));this.isConcave=this.angleBetweenPoints>180}}]);return a}();function A(a,b,c,d,e,f,g){switch(a){case 'round':return B(b,c,d,e,f,g)}}function B(a,b,c,d,e,f){return C(a,b,e,d,f,!1)}function C(a,b,c,d,e,f){var g=[],h=Math.PI*2,i=Math.atan2(c.y-a.y,c.x-a.x),j=Math.atan2(d.y-a.y,d.x-a.x);i<0&&(i+=h);j<0&&(j+=h);var k=i>j?i-j:i+h-j,l=(h-k)/e;for(var m=1;m<e+1;++m)k=i+l*m,g.push(new z([a.x+Math.cos(k)*b,a.y+Math.sin(k)*b]));return g}function D(a){if(process.env.NODE_ENV!=='development')return;var b=window.map,c=L.layerGroup([]).addTo(b);a.forEach(function(a){L.circleMarker([a.y,a.x],{color:a.isConcave?'red':'green'}).addTo(c)});c.remove()}function E(a){if(process.env.NODE_ENV!=='development')return;var b=window.map,c=L.layerGroup([]).addTo(b);a.forEach(function(a){L.polyline([[a.offsetPoint1.y,a.offsetPoint1.x],[a.offsetPoint2.y,a.offsetPoint2.x]],{color:'red'}).addTo(c)});c.remove()}var F=function c(a,b){e(this,c);this.key=a;this.data=b;this.left=null;this.right=null};function G(a,b){return a>b?1:a<b?-1:0}function H(a,b,c){if(b===null)return b;var d,e,f,g=new F();d=e=g;while(!0){var h=c(a,b.key);if(h<0){if(b.left===null)break;if(c(a,b.left.key)<0){f=b.left;b.left=f.right;f.right=b;b=f;if(b.left===null)break}e.left=b;e=b;b=b.left}else if(h>0){if(b.right===null)break;if(c(a,b.right.key)>0){f=b.right;b.right=f.left;f.left=b;b=f;if(b.right===null)break}d.right=b;d=b;b=b.right}else{break}}d.right=b.left;e.left=b.right;b.left=g.right;b.right=g.left;return b}function I(a,b,c,d,e){var f=new F(a,b);e._size++;if(c===null){f.left=f.right=null;return f}c=H(a,c,d);var g=d(a,c.key);g<0?(f.left=c.left,f.right=c,c.left=null):g>=0&&(f.right=c.right,f.left=c,c.right=null);return f}function J(a,b,c,d,e){var f=new F(a,b);if(c===null){f.left=f.right=null;e._size++;return f}c=H(a,c,d);var g=d(a,c.key);if(g===0)return c;else{g<0?(f.left=c.left,f.right=c,c.left=null):g>0&&(f.right=c.right,f.left=c,c.right=null);e._size++;return f}}function K(a,b,c,d){var e;if(b===null)return null;b=H(a,b,c);var f=c(a,b.key);if(f===0){b.left===null?(e=b.right):(e=H(a,b.left,c),e.right=b.right);d._size--;return e}return b}function M(a,b,c){var d,e;if(b===null)d=e=null;else{b=H(a,b,c);var f=c(b.key,a);f===0?(d=b.left,e=b.right):f<0?(e=b.right,b.right=null,d=b):(d=b.left,b.left=null,e=b)}return{left:d,right:e}}function N(a,b,c){if(b===null)return a;if(a===null)return b;b=H(a.key,b,c);b.left=a;return b}function O(a,b,c,d,e){if(a){d("".concat(b).concat(c?'└── ':'├── ').concat(e(a),"\n"));var f=b+(c?'    ':'│   ');a.left&&O(a.left,f,!1,d,e);a.right&&O(a.right,f,!0,d,e)}}var P=function(){function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:G;e(this,a);this._comparator=b;this._root=null;this._size=0}g(a,[{key:"insert",value:function c(a,b){return this._root=I(a,b,this._root,this._comparator,this)}},{key:"add",value:function c(a,b){return this._root=J(a,b,this._root,this._comparator,this)}},{key:"remove",value:function b(a){this._root=K(a,this._root,this._comparator,this)}},{key:"pop",value:function a(){var b=this._root;if(b){while(b.left)b=b.left;this._root=H(b.key,this._root,this._comparator);this._root=K(b.key,this._root,this._comparator,this);return{key:b.key,data:b.data}}return null}},{key:"findStatic",value:function b(a){var c=this._root,d=this._comparator;while(c){var e=d(a,c.key);if(e===0)return c;else e<0?(c=c.left):(c=c.right)}return null}},{key:"find",value:function b(a){if(this._root){this._root=H(a,this._root,this._comparator);if(this._comparator(a,this._root.key)!==0)return null}return this._root}},{key:"contains",value:function b(a){var c=this._root,d=this._comparator;while(c){var e=d(a,c.key);if(e===0)return !0;else e<0?(c=c.left):(c=c.right)}return !1}},{key:"forEach",value:function c(a,b){var d=this._root,e=[],f=!1;while(!f)d!==null?(e.push(d),d=d.left):e.length!==0?(d=e.pop(),a.call(b,d),d=d.right):(f=!0);return this}},{key:"range",value:function e(a,b,c,d){var f=[],g=this._comparator,h=this._root,i;while(f.length!==0||h){if(h)f.push(h),h=h.left;else{h=f.pop();i=g(h.key,b);if(i>0){break}else if(g(h.key,a)>=0){if(c.call(d,h))return this};h=h.right}}return this}},{key:"keys",value:function(){var a=[];this.forEach(function(b){var c=b.key;return a.push(c)});return a}},{key:"values",value:function(){var a=[];this.forEach(function(b){var c=b.data;return a.push(c)});return a}},{key:"min",value:function a(){if(this._root)return this.minNode(this._root).key;return null}},{key:"max",value:function a(){if(this._root)return this.maxNode(this._root).key;return null}},{key:"minNode",value:function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this._root;if(b)while(b.left)b=b.left;return b}},{key:"maxNode",value:function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this._root;if(b)while(b.right)b=b.right;return b}},{key:"at",value:function b(a){var c=this._root,d=!1,e=0,f=[];while(!d){if(c)f.push(c),c=c.left;else{if(f.length>0){c=f.pop();if(e===a)return c;e++;c=c.right}else d=!0}}return null}},{key:"next",value:function b(a){var c=this._root,d=null;if(a.right){d=a.right;while(d.left)d=d.left;return d}var e=this._comparator;while(c){var f=e(a.key,c.key);if(f===0)break;else f<0?(d=c,c=c.left):(c=c.right)}return d}},{key:"prev",value:function b(a){var c=this._root,d=null;if(a.left!==null){d=a.left;while(d.right)d=d.right;return d}var e=this._comparator;while(c){var f=e(a.key,c.key);if(f===0)break;else f<0?(c=c.left):(d=c,c=c.right)}return d}},{key:"clear",value:function a(){this._root=null;this._size=0;return this}},{key:"toList",value:function a(){return S(this._root)}},{key:"load",value:function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[],c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[],d=arguments.length>2&&arguments[2]!==undefined?arguments[2]:!1,e=b.length,f=this._comparator;d&&V(b,c,0,e-1,f);if(this._root===null)this._root=Q(this._root,b,c,0,e),this._size=e;else{var g=U(this.toList(),R(b,c),f);e=this._size+e;this._root=T({head:g},0,e)}return this}},{key:"isEmpty",value:function a(){return this._root===null}},{key:"toString",value:function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:function(a){return a.key},c=[];O(this._root,'',!0,function(a){return c.push(a)},b);return c.join('')}},{key:"update",value:function d(a,b,c){var e=this._comparator,f=M(a,this._root,e),g=f.left,h=f.right;this._size--;e(a,b)<0?(h=I(b,c,h,e,this)):(g=I(b,c,g,e,this));this._root=N(g,h,e)}},{key:"split",value:function b(a){return M(a,this._root,this._comparator)}},{key:"size",get:function a(){return this._size}}]);return a}();function Q(a,b,c,d,e){var f=e-d;if(f>0){var g=d+Math.floor(f/2),h=b[g],i=c[g],j={key:h,data:i,parent:a};j.left=Q(j,b,c,d,g);j.right=Q(j,b,c,g+1,e);return j}return null}function R(a,b){var c={next:null},d=c;for(var e=0;e<a.length;e++)d=d.next={key:a[e],data:b[e]};d.next=null;return c.next}function S(a){var b=a,c=[],d=!1,e={next:null},f=e;while(!d)b?(c.push(b),b=b.left):c.length>0?(b=f=f.next=c.pop(),b=b.right):(d=!0);f.next=null;return e.next}function T(a,b,c){var d=c-b;if(d>0){var e=b+Math.floor(d/2),f=T(a,b,e),g=a.head;g.left=f;a.head=a.head.next;g.right=T(a,e+1,c);return g}return null}function U(c,d){var e=arguments.length>2&&arguments[2]!==undefined?arguments[2]:function(a,b){return a-b},f={},g=f,h=c,i=d;while(h!==null&&i!==null)e(h.key,i.key)<0?(g.next=h,h=h.next):(g.next=i,i=i.next),g=g.next;h!==null?(g.next=h):i!==null&&(g.next=i);return f.next}function V(a,b,c,d,e){if(c>=d)return;var f=a[c+d>>1],g=c-1,h=d+1;while(!0){do{g++}while(e(a[g],f)<0);do{h--}while(e(a[h],f)>0);if(g>=h)break;var i=a[g];a[g]=a[h];a[h]=i;i=b[g];b[g]=b[h];b[h]=i}V(a,b,c,h,e);V(a,b,h+1,d,e)}function W(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function X(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value" in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}function Y(a,b,c){b&&X(a.prototype,b);c&&X(a,c);return a}var Z=function c(a,b){return a.ll.x<=b.x&&b.x<=a.ur.x&&a.ll.y<=b.y&&b.y<=a.ur.y},_=function c(a,b){if(b.ur.x<a.ll.x||a.ur.x<b.ll.x||b.ur.y<a.ll.y||a.ur.y<b.ll.y)return null;var d=a.ll.x<b.ll.x?b.ll.x:a.ll.x,e=a.ur.x<b.ur.x?a.ur.x:b.ur.x,f=a.ll.y<b.ll.y?b.ll.y:a.ll.y,g=a.ur.y<b.ur.y?a.ur.y:b.ur.y;return{ll:{x:d,y:f},ur:{x:e,y:g}}},$=Number.EPSILON;$===undefined&&($=Math.pow(2,-52));var aa=$*$,ab=function c(a,b){if(-$<a&&a<$){if(-$<b&&b<$){return 0}}if(a<0&&0<b)return-1;if(b<0&&0<a)return 1;var d=a-b;if(d*d<aa*a*b){return 0}return a<b?-1:1},ac=function c(a,b){return a.x*b.y-a.y*b.x},ad=function c(a,b){return a.x*b.x+a.y*b.y},ae=function d(a,b,c){var e={x:b.x-a.x,y:b.y-a.y},f={x:c.x-a.x,y:c.y-a.y},g=ac(e,f);return ab(g,0)},af=function b(a){return Math.sqrt(ad(a,a))},ag=function d(a,b,c){var e={x:b.x-a.x,y:b.y-a.y},f={x:c.x-a.x,y:c.y-a.y};return ac(f,e)/af(f)/af(e)},ah=function d(a,b,c){var e={x:b.x-a.x,y:b.y-a.y},f={x:c.x-a.x,y:c.y-a.y};return ad(f,e)/af(f)/af(e)},ai=function d(a,b,c){if(a.x===b.x)return{x:a.x,y:c.y};if(a.y===b.y)return{x:c.x,y:a.y};var e={x:c.x-a.x,y:c.y-a.y},f={x:c.x-b.x,y:c.y-b.y},g,h,i;ad(e,e)>ad(f,f)?(g=e,h={x:b.x-a.x,y:b.y-a.y},i=a):(g=f,h={x:a.x-b.x,y:a.y-b.y},i=b);var j=ad(h,g)/ad(h,h);return{x:i.x+j*h.x,y:i.y+j*h.y}},aj=function d(a,b,c){if(b.y===0)return null;return{x:a.x+b.x/b.y*(c-a.y),y:c}},ak=function d(a,b,c){if(b.x===0)return null;return{x:c,y:a.y+b.y/b.x*(c-a.x)}},al=function e(a,b,c,d){if(b.x===0)return ak(c,d,a.x);if(d.x===0)return ak(a,b,c.x);if(b.y===0)return aj(c,d,a.y);if(d.y===0)return aj(a,b,c.y);var f=ac(b,d);if(f==0)return null;var g={x:c.x-a.x,y:c.y-a.y},h=ac(g,b)/f,i=ac(g,d)/f,j=a.x+i*b.x,k=c.x+h*d.x,l=a.y+i*b.y,m=c.y+h*d.y,n=(j+k)/2,o=(l+m)/2;return{x:n,y:o}},am=function(){function a(){W(this,a);this.reset()}Y(a,[{key:"reset",value:function a(){this.xRounder=new an();this.yRounder=new an()}},{key:"round",value:function c(a,b){return{x:this.xRounder.round(a),y:this.yRounder.round(b)}}}]);return a}(),an=function(){function a(){W(this,a);this.tree=new P();this.round(0)}Y(a,[{key:"round",value:function b(a){var c=this.tree.add(a),d=this.tree.prev(c);if(d!==null&&ab(c.key,d.key)===0){this.tree.remove(a);return d.key}var e=this.tree.next(c);if(e!==null&&ab(c.key,e.key)===0){this.tree.remove(a);return e.key}return a}}]);return a}(),ao=new am(),ap=function b(a){var c=[];if(!Array.isArray(a)){throw new Error('Input is not a Polygon or MultiPolygon')}for(var d=0,e=a.length;d<e;d++){if(!Array.isArray(a[d])||a[d].length==0){throw new Error('Input is not a Polygon or MultiPolygon')}c.push([]);for(var f=0,g=a[d].length;f<g;f++){if(!Array.isArray(a[d][f])||a[d][f].length==0){throw new Error('Input is not a Polygon or MultiPolygon')}if(Array.isArray(a[d][f][0])){c[d].push([]);for(var h=0,i=a[d][f].length;h<i;h++){if(!Array.isArray(a[d][f][h])||a[d][f][h].length<2){throw new Error('Input is not a Polygon or MultiPolygon')}if(a[d][f][h].length>2){throw new Error("Input has more than two coordinates. Only 2-dimensional polygons supported.")}c[d][f].push(ao.round(a[d][f][h][0],a[d][f][h][1]))}}else{if(a[d][f].length<2){throw new Error('Input is not a Polygon or MultiPolygon')}if(a[d][f].length>2){throw new Error("Input has more than two coordinates. Only 2-dimensional polygons supported.")}c[d].push(ao.round(a[d][f][0],a[d][f][1]))}}}return c},aq=function b(a){if(Array.isArray(a)){if(a.length===0)return;if(Array.isArray(a[0])){if(Array.isArray(a[0][0])){if(typeof a[0][0][0].x==='number'&&typeof a[0][0][0].y==='number'){return}}if(typeof a[0][0].x==='number'&&typeof a[0][0].y==='number'){a.unshift(a.splice(0));return}}}throw new Error('Unrecognized input - not a polygon nor multipolygon')},ar=function b(a){var c=0;while(c<a.length){var d=a[c];if(d.length===0){a.splice(c,1);continue}var e=d[0];as(e);if(e.length===0){a.splice(c,1);continue}var f=1;while(f<d.length){var g=d[f];as(g);g.length===0?d.splice(f,1):f++}c++}},as=function b(a){if(a.length===0)return;var c=a[0],d=a[a.length-1];c.x===d.x&&c.y===d.y&&a.pop();var e=function d(a,b,c){return a.x===b.x&&a.y===b.y||c.x===b.x&&c.y===b.y||ae(b,a,c)===0},f=0,g,h;while(f<a.length)g=f===0?a[a.length-1]:a[f-1],h=f===a.length-1?a[0]:a[f+1],e(g,a[f],h)?a.splice(f,1):f++;while(a.length<3&&a.length>0)a.pop()},at=function(){Y(c,null,[{key:"compare",value:function d(a,b){var e=c.comparePoints(a.point,b.point);if(e!==0)return e;a.point!==b.point&&a.link(b);if(a.isLeft!==b.isLeft)return a.isLeft?1:-1;return av.compare(a.segment,b.segment)}},{key:"comparePoints",value:function c(a,b){if(a.x<b.x)return-1;if(a.x>b.x)return 1;if(a.y<b.y)return-1;if(a.y>b.y)return 1;return 0}}]);function c(a,b){W(this,c);a.events===undefined?(a.events=[this]):a.events.push(this);this.point=a;this.isLeft=b}Y(c,[{key:"link",value:function b(a){if(a.point===this.point){throw new Error('Tried to link already linked events')}var c=a.point.events;for(var d=0,e=c.length;d<e;d++){var f=c[d];this.point.events.push(f);f.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function a(){var b=this.point.events.length;for(var c=0;c<b;c++){var d=this.point.events[c];if(d.segment.consumedBy!==undefined)continue;for(var e=c+1;e<b;e++){var f=this.point.events[e];if(f.consumedBy!==undefined)continue;if(d.otherSE.point.events!==f.otherSE.point.events)continue;d.segment.consume(f.segment)}}}},{key:"getAvailableLinkedEvents",value:function a(){var b=[];for(var c=0,d=this.point.events.length;c<d;c++){var e=this.point.events[c];e!==this&&!e.segment.ringOut&&e.segment.isInResult()&&b.push(e)}return b}},{key:"getLeftmostComparator",value:function d(c){var e=this,f=new Map(),g=function b(a){var d=a.otherSE;f.set(a,{sine:ag(e.point,c.point,d.point),cosine:ah(e.point,c.point,d.point)})};return function(a,b){f.has(a)||g(a);f.has(b)||g(b);var c=f.get(a),d=c.sine,e=c.cosine,h=f.get(b),i=h.sine,j=h.cosine;if(d>=0&&i>=0){if(e<j)return 1;if(e>j)return-1;return 0}if(d<0&&i<0){if(e<j)return-1;if(e>j)return 1;return 0}if(i<d)return-1;if(i>d)return 1;return 0}}}]);return c}(),au=0,av=function(){Y(c,null,[{key:"compare",value:function c(a,b){var d=a.leftSE.point.x,e=b.leftSE.point.x,f=a.rightSE.point.x,g=b.rightSE.point.x;if(g<d)return 1;if(f<e)return-1;var h=a.leftSE.point.y,i=b.leftSE.point.y,j=a.rightSE.point.y,k=b.rightSE.point.y;if(d<e){if(i<h&&i<j)return 1;if(i>h&&i>j)return-1;var l=a.comparePoint(b.leftSE.point);if(l<0)return 1;if(l>0)return-1;var m=b.comparePoint(a.rightSE.point);if(m!==0)return m;return-1}if(d>e){if(h<i&&h<k)return-1;if(h>i&&h>k)return 1;var n=b.comparePoint(a.leftSE.point);if(n!==0)return n;var o=a.comparePoint(b.rightSE.point);if(o<0)return 1;if(o>0)return-1;return 1}if(h<i)return-1;if(h>i)return 1;if(f<g){var p=b.comparePoint(a.rightSE.point);if(p!==0)return p}if(f>g){var q=a.comparePoint(b.rightSE.point);if(q<0)return 1;if(q>0)return-1}if(f!==g){var r=j-h,s=f-d,t=k-i,u=g-e;if(r>s&&t<u)return 1;if(r<s&&t>u)return-1}if(f>g)return 1;if(f<g)return-1;if(j<k)return-1;if(j>k)return 1;if(a.id<b.id)return-1;if(a.id>b.id)return 1;return 0}}]);function c(a,b,d,e){W(this,c);this.id=++au;this.leftSE=a;a.segment=this;a.otherSE=b;this.rightSE=b;b.segment=this;b.otherSE=a;this.rings=d;this.windings=e}Y(c,[{key:"replaceRightSE",value:function b(a){this.rightSE=a;this.rightSE.segment=this;this.rightSE.otherSE=this.leftSE;this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function a(){var b=this.leftSE.point.y,c=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:b<c?b:c},ur:{x:this.rightSE.point.x,y:b>c?b:c}}}},{key:"vector",value:function a(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function b(a){return a.x===this.leftSE.point.x&&a.y===this.leftSE.point.y||a.x===this.rightSE.point.x&&a.y===this.rightSE.point.y}},{key:"comparePoint",value:function b(a){if(this.isAnEndpoint(a))return 0;var c=ai(this.leftSE.point,this.rightSE.point,a),d=this.leftSE.point.x,e=this.leftSE.point.y,f=this.rightSE.point.x,g=this.rightSE.point.y;if(g>=e){if(g-e>f-d){var h=ab(c.x,a.x);if(h!=0)return h}else{var i=ab(a.y,c.y);if(i!=0)return i}}else{if(e-g>f-d){var j=ab(a.x,c.x);if(j!=0)return j}else{var k=ab(a.y,c.y);if(k!=0)return k}}return 0}},{key:"getIntersection",value:function b(a){var c=this.bbox(),d=a.bbox(),e=_(c,d);if(e===null)return null;var f=this.leftSE.point,g=this.rightSE.point,h=a.leftSE.point,i=a.rightSE.point,j=Z(c,h)&&this.comparePoint(h)===0,k=Z(d,f)&&a.comparePoint(f)===0,l=Z(c,i)&&this.comparePoint(i)===0,m=Z(d,g)&&a.comparePoint(g)===0;if(k&&j){if(m&&!l)return g;if(!m&&l)return i;return null}if(k){if(l){if(f.x===i.x&&f.y===i.y)return null}return f}if(j){if(m){if(g.x===h.x&&g.y===h.y)return null}return h}if(m&&l)return null;if(m)return g;if(l)return i;var n=al(f,this.vector(),h,a.vector());if(n===null)return null;if(!Z(e,n))return null;return ao.round(n.x,n.y)}},{key:"split",value:function b(a){var d=[],e=a.events!==undefined,f=new at(a,!0),g=new at(a,!1),h=this.rightSE;this.replaceRightSE(g);d.push(g);d.push(f);var i=new c(f,h,this.rings.slice(),this.windings.slice());at.comparePoints(i.leftSE.point,i.rightSE.point)>0&&i.swapEvents();at.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents();e&&(f.checkForConsuming(),g.checkForConsuming());return d}},{key:"swapEvents",value:function a(){var b=this.rightSE;this.rightSE=this.leftSE;this.leftSE=b;this.leftSE.isLeft=!0;this.rightSE.isLeft=!1;for(var c=0,d=this.windings.length;c<d;c++)this.windings[c]*=-1}},{key:"consume",value:function b(a){var d=this,e=a;while(d.consumedBy)d=d.consumedBy;while(e.consumedBy)e=e.consumedBy;var f=c.compare(d,e);if(f===0)return;if(f>0){var g=d;d=e;e=g}if(d.prev===e){var h=d;d=e;e=h}for(var i=0,j=e.rings.length;i<j;i++){var k=e.rings[i],l=e.windings[i],m=d.rings.indexOf(k);m===-1?(d.rings.push(k),d.windings.push(l)):(d.windings[m]+=l)}e.rings=null;e.windings=null;e.consumedBy=d;e.leftSE.consumedBy=d.leftSE;e.rightSE.consumedBy=d.rightSE}},{key:"prevInResult",value:function a(){if(this._prevInResult!==undefined)return this._prevInResult;this.prev?this.prev.isInResult()?(this._prevInResult=this.prev):(this._prevInResult=this.prev.prevInResult()):(this._prevInResult=null);return this._prevInResult}},{key:"beforeState",value:function a(){if(this._beforeState!==undefined)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var b=this.prev.consumedBy||this.prev;this._beforeState=b.afterState()}return this._beforeState}},{key:"afterState",value:function a(){if(this._afterState!==undefined)return this._afterState;var b=this.beforeState();this._afterState={rings:b.rings.slice(0),windings:b.windings.slice(0),multiPolys:[]};var c=this._afterState.rings,d=this._afterState.windings,e=this._afterState.multiPolys;for(var f=0,g=this.rings.length;f<g;f++){var h=this.rings[f],i=this.windings[f],j=c.indexOf(h);j===-1?(c.push(h),d.push(i)):(d[j]+=i)}var k=[],l=[];for(var m=0,n=c.length;m<n;m++){if(d[m]===0)continue;var o=c[m],p=o.poly;if(l.indexOf(p)!==-1)continue;if(o.isExterior)k.push(p);else{l.indexOf(p)===-1&&l.push(p);var q=k.indexOf(o.poly);q!==-1&&k.splice(q,1)}}for(var r=0,s=k.length;r<s;r++){var t=k[r].multiPoly;e.indexOf(t)===-1&&e.push(t)}return this._afterState}},{key:"isInResult",value:function a(){if(this.consumedBy)return !1;if(this._isInResult!==undefined)return this._isInResult;var b=this.beforeState().multiPolys,c=this.afterState().multiPolys;switch(aE.type){case 'union':{var h=b.length===0,i=c.length===0;this._isInResult=h!==i;break};case 'intersection':{var f,g;b.length<c.length?(f=b.length,g=c.length):(f=c.length,g=b.length);this._isInResult=g===aE.numMultiPolys&&f<g;break};case 'xor':{var e=Math.abs(b.length-c.length);this._isInResult=e%2===1;break};case 'difference':{var d=function b(a){return a.length===1&&a[0].isSubject};this._isInResult=d(b)!==d(c);break};default:throw new Error("Unrecognized operation type found ".concat(aE.type))};return this._isInResult}}],[{key:"fromRing",value:function e(a,b,d){var f,g,h,i=at.comparePoints(a,b);if(i<0)f=a,g=b,h=1;else if(i>0)f=b,g=a,h=-1;else throw new Error("Tried to create degenerate segment at [".concat(a.x,", ").concat(a.y,"]"));var j=new at(f,!0),k=new at(g,!1);return new c(j,k,[d],[h])}}]);return c}(),aw=function(){function a(b,c,d){W(this,a);this.poly=c;this.isExterior=d;this.segments=[];var e=b[0];this.bbox={ll:{x:e.x,y:e.y},ur:{x:e.x,y:e.y}};for(var f=1,g=b.length;f<g;f++){var h=b[f];this.segments.push(av.fromRing(e,h,this));h.x<this.bbox.ll.x&&(this.bbox.ll.x=h.x);h.y<this.bbox.ll.y&&(this.bbox.ll.y=h.y);h.x>this.bbox.ur.x&&(this.bbox.ur.x=h.x);h.y>this.bbox.ur.y&&(this.bbox.ur.y=h.y);e=h}this.segments.push(av.fromRing(e,b[0],this))}Y(a,[{key:"getSweepEvents",value:function a(){var b=[];for(var c=0,d=this.segments.length;c<d;c++){var e=this.segments[c];b.push(e.leftSE);b.push(e.rightSE)}return b}}]);return a}(),ax=function(){function a(b,c){W(this,a);this.exteriorRing=new aw(b[0],this,!0);this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}};this.interiorRings=[];for(var d=1,e=b.length;d<e;d++){var f=new aw(b[d],this,!1);f.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=f.bbox.ll.x);f.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=f.bbox.ll.y);f.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=f.bbox.ur.x);f.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=f.bbox.ur.y);this.interiorRings.push(f)}this.multiPoly=c}Y(a,[{key:"getSweepEvents",value:function a(){var b=this.exteriorRing.getSweepEvents();for(var c=0,d=this.interiorRings.length;c<d;c++){var e=this.interiorRings[c].getSweepEvents();for(var f=0,g=e.length;f<g;f++)b.push(e[f])}return b}}]);return a}(),ay=function(){function a(b){W(this,a);this.polys=[];this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var c=0,d=b.length;c<d;c++){var e=new ax(b[c],this);e.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=e.bbox.ll.x);e.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=e.bbox.ll.y);e.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=e.bbox.ur.x);e.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=e.bbox.ur.y);this.polys.push(e)}this.isSubject=!1}Y(a,[{key:"markAsSubject",value:function a(){this.isSubject=!0}},{key:"getSweepEvents",value:function a(){var b=[];for(var c=0,d=this.polys.length;c<d;c++){var e=this.polys[c].getSweepEvents();for(var f=0,g=e.length;f<g;f++)b.push(e[f])}return b}}]);return a}(),az=function(){Y(a,null,[{key:"factory",value:function c(b){var d=[];for(var e=0,f=b.length;e<f;e++){var g=b[e];if(!g.isInResult()||g.ringOut)continue;var h=null,i=g.leftSE,j=g.rightSE,k=[i],l=i.point,m=[];while(!0){h=i;i=j;k.push(i);if(i.point===l)break;while(!0){var n=i.getAvailableLinkedEvents();if(n.length===0){var o=k[0].point,p=k[k.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(o.x,",")+" ".concat(o.y,"]. Last matching segment found ends at")+" [".concat(p.x,", ").concat(p.y,"]."))}if(n.length===1){j=n[0].otherSE;break}var q=null;for(var r=0,s=m.length;r<s;r++){if(m[r].point===i.point){q=r;break}}if(q!==null){var t=m.splice(q)[0],u=k.splice(t.index);u.unshift(u[0].otherSE);d.push(new a(u.reverse()));continue}m.push({index:k.length,point:i.point});var v=i.getLeftmostComparator(h);j=n.sort(v)[0].otherSE;break}}d.push(new a(k))}return d}}]);function a(b){W(this,a);this.events=b;for(var c=0,d=b.length;c<d;c++)b[c].segment.ringOut=this;this.poly=null}Y(a,[{key:"getGeom",value:function a(){var b=this.events[0].point,c=[b];for(var d=1,e=this.events.length-1;d<e;d++){var f=this.events[d].point,g=this.events[d+1].point;if(ae(f,b,g)===0)continue;c.push(f);b=f}if(c.length===1)return null;var h=c[0],i=c[1];ae(h,b,i)===0&&c.shift();c.push(c[0]);var j=this.isExteriorRing()?1:-1,k=this.isExteriorRing()?0:c.length-1,l=this.isExteriorRing()?c.length:-1,m=[];for(var n=k;n!=l;n+=j)m.push([c[n].x,c[n].y]);return m}},{key:"isExteriorRing",value:function a(){if(this._isExteriorRing===undefined){var b=this.enclosingRing();this._isExteriorRing=b?!b.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function a(){this._enclosingRing===undefined&&(this._enclosingRing=this._calcEnclosingRing());return this._enclosingRing}},{key:"_calcEnclosingRing",value:function a(){var b=this.events[0];for(var c=1,d=this.events.length;c<d;c++){var e=this.events[c];at.compare(b,e)>0&&(b=e)}var f=b.segment.prevInResult(),g=f?f.prevInResult():null;while(!0){if(!f)return null;if(!g)return f.ringOut;if(g.ringOut!==f.ringOut){if(g.ringOut.enclosingRing()!==f.ringOut){return f.ringOut}else return f.ringOut.enclosingRing()}f=g.prevInResult();g=f?f.prevInResult():null}}}]);return a}(),aA=function(){function a(b){W(this,a);this.exteriorRing=b;b.poly=this;this.interiorRings=[]}Y(a,[{key:"addInterior",value:function b(a){this.interiorRings.push(a);a.poly=this}},{key:"getGeom",value:function a(){var b=[this.exteriorRing.getGeom()];if(b[0]===null)return null;for(var c=0,d=this.interiorRings.length;c<d;c++){var e=this.interiorRings[c].getGeom();if(e===null)continue;b.push(e)}return b}}]);return a}(),aB=function(){function a(b){W(this,a);this.rings=b;this.polys=this._composePolys(b)}Y(a,[{key:"getGeom",value:function a(){var b=[];for(var c=0,d=this.polys.length;c<d;c++){var e=this.polys[c].getGeom();if(e===null)continue;b.push(e)}return b}},{key:"_composePolys",value:function b(a){var c=[];for(var d=0,e=a.length;d<e;d++){var f=a[d];if(f.poly)continue;if(f.isExteriorRing())c.push(new aA(f));else{var g=f.enclosingRing();g.poly||c.push(new aA(g));g.poly.addInterior(f)}}return c}}]);return a}(),aC=function(){function a(b){var c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:av.compare;W(this,a);this.queue=b;this.tree=new P(c);this.segments=[]}Y(a,[{key:"process",value:function b(a){var c=a.segment,d=[];if(a.consumedBy){a.isLeft?this.queue.remove(a.otherSE):this.tree.remove(c);return d}var e=a.isLeft?this.tree.insert(c):this.tree.find(c);if(!e)throw new Error("Unable to find segment #".concat(c.id," ")+"[".concat(c.leftSE.point.x,", ").concat(c.leftSE.point.y,"] -> ")+"[".concat(c.rightSE.point.x,", ").concat(c.rightSE.point.y,"] ")+'in SweepLine tree. Please submit a bug report.');var f=e,g=e,h=undefined,i=undefined;while(h===undefined)f=this.tree.prev(f),f===null?(h=null):f.key.consumedBy===undefined&&(h=f.key);while(i===undefined)g=this.tree.next(g),g===null?(i=null):g.key.consumedBy===undefined&&(i=g.key);if(a.isLeft){var j=null;if(h){var k=h.getIntersection(c);if(k!==null){c.isAnEndpoint(k)||(j=k);if(!h.isAnEndpoint(k)){var l=this._splitSafely(h,k);for(var m=0,n=l.length;m<n;m++)d.push(l[m])}}}var o=null;if(i){var p=i.getIntersection(c);if(p!==null){c.isAnEndpoint(p)||(o=p);if(!i.isAnEndpoint(p)){var q=this._splitSafely(i,p);for(var r=0,s=q.length;r<s;r++)d.push(q[r])}}}if(j!==null||o!==null){var t=null;if(j===null)t=o;else if(o===null)t=j;else{var u=at.comparePoints(j,o);u<0&&(t=j);u>0&&(t=o);t=j};this.queue.remove(c.rightSE);d.push(c.rightSE);var v=c.split(t);for(var w=0,x=v.length;w<x;w++)d.push(v[w])}d.length>0?(this.tree.remove(c),d.push(a)):(this.segments.push(c),c.prev=h)}else{if(h&&i){var y=h.getIntersection(i);if(y!==null){if(!h.isAnEndpoint(y)){var z=this._splitSafely(h,y);for(var A=0,B=z.length;A<B;A++)d.push(z[A])}if(!i.isAnEndpoint(y)){var C=this._splitSafely(i,y);for(var D=0,E=C.length;D<E;D++)d.push(C[D])}}}this.tree.remove(c)}return d}},{key:"_splitSafely",value:function c(a,b){this.tree.remove(a);var d=a.rightSE;this.queue.remove(d);var e=a.split(b);e.push(d);a.consumedBy===undefined&&this.tree.insert(a);return e}}]);return a}(),aD=function(){function a(){W(this,a)}Y(a,[{key:"run",value:function d(a,b,c){aE.type=a;ao.reset();var e=[ap(b)];for(var f=0,g=c.length;f<g;f++)e.push(ap(c[f]));for(var h=0,i=e.length;h<i;h++)aq(e[h]),ar(e[h]);var j=[];for(var k=0,l=e.length;k<l;k++)j.push(new ay(e[k]));j[0].markAsSubject();aE.numMultiPolys=j.length;if(aE.type==='difference'){var m=j[0],n=1;while(n<j.length)_(j[n].bbox,m.bbox)!==null?n++:j.splice(n,1)}if(aE.type==='intersection'){for(var o=0,p=j.length;o<p;o++){var q=j[o];for(var r=o+1,s=j.length;r<s;r++){if(_(q.bbox,j[r].bbox)===null)return[]}}}var t=new P(at.compare);for(var u=0,v=j.length;u<v;u++){var w=j[u].getSweepEvents();for(var x=0,y=w.length;x<y;x++)t.insert(w[x])}var z=new aC(t),A=t.size,B=t.pop();while(B){var C=B.key;if(t.size===A){var D=C.segment;throw new Error("Unable to pop() ".concat(C.isLeft?'left':'right'," SweepEvent ")+"[".concat(C.point.x,", ").concat(C.point.y,"] from segment #").concat(D.id," ")+"[".concat(D.leftSE.point.x,", ").concat(D.leftSE.point.y,"] -> ")+"[".concat(D.rightSE.point.x,", ").concat(D.rightSE.point.y,"] from queue. ")+'Please file a bug report.')}var E=z.process(C);for(var F=0,G=E.length;F<G;F++){var H=E[F];H.consumedBy===undefined&&t.insert(H)}A=t.size;B=t.pop()}ao.reset();var I=az.factory(z.segments),J=new aB(I);return J.getGeom()}}]);return a}(),aE=new aD(),aF=function b(a){for(var c=arguments.length,d=new Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];return aE.run('union',a,d)},aG=function b(a){for(var c=arguments.length,d=new Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];return aE.run('intersection',a,d)},aH=function b(a){for(var c=arguments.length,d=new Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];return aE.run('xor',a,d)},aI=function b(a){for(var c=arguments.length,d=new Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];return aE.run('difference',a,d)},aJ={union:aF,intersection:aG,xor:aH,difference:aI},aY=function(){function a(b){e(this,a);this.edges=[];this.points=[];this.isHole=b;this.outContour=[]}g(a,[{key:"offsetEdges",value:function b(a){for(var c=0;c<this.edges.length;c++)this.edges[c].offsetEdge(a);E(this.edges)}},{key:"rejoinOffsetEdges",value:function c(a,b){for(var d=0;d<this.edges.length;d++){var e=this.edges[d],f=e.point1;if(f.isConcave)this.outContour.push(e.getIntersection(e.prevEdge));else{var h=A('round',e.point1,a,b,e.offsetPoint1,e.prevEdge.offsetPoint2,32);this.outContour=this.outContour.concat(h)}}}},{key:"removeGlobalIntersections",value:function a(){var b=this.outContour.map(function(a){return[a.x,a.y]});return aJ.union([b])}}]);return a}(),aZ=function(){function a(b,c){e(this,a);this.point1=b;this.point2=c;this.offsetPoint1=null;this.offsetPoint2=null;this.edgeLengthRadians=this.getEdgeLengthInRadians()}g(a,[{key:"offsetEdge",value:function b(a){var c=h(this.point1,this.point2,a);this.offsetPoint1=c[0];this.offsetPoint2=c[1]}},{key:"getIntersection",value:function b(a){var c=j(this.offsetPoint1.x,this.offsetPoint1.y,this.offsetPoint2.x,this.offsetPoint2.y,a.offsetPoint1.x,a.offsetPoint1.y,a.offsetPoint2.x,a.offsetPoint2.y);return c}},{key:"getEdgeLengthInRadians",value:function a(){return u(this.point1,this.point2)}}]);return a}();function a_(a){var b=a.type==='Feature'?a.geometry:a,c=b.coordinates;(b.type==='Polygon'||b.type==='MultiLineString')&&(c=[c]);b.type==='LineString'&&(c=[[c]]);var d=[];for(var e=0;e<c[0].length;e++){var f=new aY(e>0);d.push(f);var g=new z(c[0][e][0]),h=new z(c[0][e][1]),i=new z(c[0][e][2]);a$(g,h,i);f.points.push(g);var j=new aZ(g,h);f.edges.push(j);var k=g,l=j;g=h;h=i;for(var m=2;m<c[0][e].length-2;m++){f.points.push(g);i=new z(c[0][e][m+1]);a$(g,h,i);var n=new aZ(g,h);n.prevEdge=j;j.nextEdge=n;f.edges.push(n);g=h;h=i;j=n}a$(g,h,k);var o=new aZ(j.point2,h);o.prevEdge=j;j.nextEdge=o;f.edges.push(o);var p=new aZ(h,k);p.prevEdge=o;o.nextEdge=p;l.prevEdge=p;p.nextEdge=l;f.edges.push(p);f.points.push(g);f.points.push(i)}D(d[0].points);return d}function a$(a,b,c){b.prevPoint=a;b.nextPoint=c;b.calcuateAnglesBetweeenPoints()}function ba(a,b,c,d){if(!a)throw new Error('geojson-buffer: Feature is required');if(b===undefined||b===null||isNaN(b))throw new Error('dgeojson-buffer: Distance is required');var e=a.type==='Feature'?a.geometry:a;if((e.type==='Point'||e.type==='MultiPoint'||e.type==='LineString'||e.type==='MultiLineString')&&b<0){throw new Error('geojson-buffer: If offsetting a point or linestring the distance must be positive')}var f=s(b,c),g=r(f,'degrees'),h=a_(a),i=[];for(var j=0;j<h.length;j++)h[j].offsetEdges(f),h[j].rejoinOffsetEdges(f,g),i.push(h[j].removeGlobalIntersections());return i[0]}c.bufferGeoJSON=ba;Object.defineProperty(c,'__esModule',{value:!0})}))
