!function(a,b){typeof exports==='object'&&typeof module!=='undefined'?b(exports):typeof define==='function'&&define.amd?define(['exports'],b):(b((a.geojsonBuffer={})))}(this,(function(c){'use strict';function e(a){typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?(e=function(a){return typeof a}):(e=function(a){return a&&typeof Symbol==="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a});return e(a)}function f(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function h(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value" in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}function j(a,b,c){b&&h(a.prototype,b);c&&h(a,c);return a}var k=6371008.8,l={centimeters:k*100,centimetres:k*100,degrees:180/Math.PI,feet:k*3.28084,inches:k*39.370,kilometers:k/1000,kilometres:k/1000,meters:k,metres:k,miles:k/1609.344,millimeters:k*1000,millimetres:k*1000,nauticalmiles:k/1852,radians:1,yards:k/1.0936};function m(a,b,c){c=D(c);var d={type:'Feature'};(c.id===0||c.id)&&(d.id=c.id);c.bbox&&(d.bbox=c.bbox);d.properties=b||{};d.geometry=a;return d}function o(a,b,c){c=D(c);var d={type:'Point',coordinates:a};return m(d,b,c)}function p(a,b,c){c=D(c);var d=!0,e=!1,f=undefined;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=!0){var i=h.value;if(i.length<4){throw new Error('Each LinearRing of a Polygon must have 4 or more Positions.')}for(var j=0;j<i[i.length-1].length;j++){if(i[i.length-1][j]!==i[0][j]){throw new Error('First and last Position are not equivalent.')}}}}catch(a){e=!0,f=a}finally{try{!d&&g.return!=null&&g.return()}finally{if(e){throw f}}};var k={type:'Polygon',coordinates:a};return m(k,b,c)}function q(a,b,c){c=D(c);if(a.length<2){throw new Error('coordinates must be an array of two or more positions')}var d={type:'LineString',coordinates:a};return m(d,b,c)}function r(a,b){b=D(b);var c={type:'FeatureCollection'};b.id&&(c.id=b.id);b.bbox&&(c.bbox=b.bbox);c.features=a;return c}function s(a,b,c){c=D(c);var d={type:'MultiPolygon',coordinates:a};return m(d,b,c)}function u(a,b){if(a===undefined||a===null)throw new Error('distance is required');if(b&&typeof b!=='string')throw new Error('units must be a string');var c=l[b||'kilometers'];if(!c){throw new Error(b+' units is invalid')}return a/c}function w(a,b){b===null&&(b='kilometers');return A(u(a,b))}function z(a){if(a===null||a===undefined)throw new Error('bearing is required');var b=a%360;b<0&&(b+=360);return b}function A(a){if(a===null||a===undefined)throw new Error('radians is required');var b=a%(2*Math.PI);return b*180/Math.PI}function B(a){if(a===null||a===undefined)throw new Error('degrees is required');var b=a%360;return b*Math.PI/180}function C(a){return!!a&&a.constructor===Object}function D(a){a=a||{};if(!C(a))throw new Error('options is invalid');return a}function E(a,b,c){if(a===null)return;var d,e,f,g,h,i,j,k=0,l=0,m,n=a.type,o=n==='FeatureCollection',p=n==='Feature',q=o?a.features.length:1;for(var r=0;r<q;r++){j=o?a.features[r].geometry:p?a.geometry:a;m=j?j.type==='GeometryCollection':!1;h=m?j.geometries.length:1;for(var s=0;s<h;s++){var t=0,u=0;g=m?j.geometries[s]:j;if(g===null)continue;i=g.coordinates;var v=g.type;k=c&&(v==='Polygon'||v==='MultiPolygon')?1:0;switch(v){case null:break;case 'Point':if(b(i,l,r,t,u)===!1)return !1;l++;t++;break;case 'LineString':;case 'MultiPoint':for(d=0;d<i.length;d++){if(b(i[d],l,r,t,u)===!1)return !1;l++;v==='MultiPoint'&&t++};v==='LineString'&&t++;break;case 'Polygon':;case 'MultiLineString':for(d=0;d<i.length;d++){for(e=0;e<i[d].length-k;e++){if(b(i[d][e],l,r,t,u)===!1)return !1;l++}v==='MultiLineString'&&t++;v==='Polygon'&&u++};v==='Polygon'&&t++;break;case 'MultiPolygon':for(d=0;d<i.length;d++){u=0;for(e=0;e<i[d].length;e++){for(f=0;f<i[d][e].length-k;f++){if(b(i[d][e][f],l,r,t,u)===!1)return !1;l++}u++}t++};break;case 'GeometryCollection':for(d=0;d<g.geometries.length;d++){if(E(g.geometries[d],b,c)===!1)return !1};break;default:throw new Error('Unknown Geometry Type')}}}}function F(a,b){if(a.type==='Feature')b(a,0);else if(a.type==='FeatureCollection'){for(var c=0;c<a.features.length;c++){if(b(a.features[c],c)===!1)break}}}function G(a,b){var c,d,e,f,g,h,i,j,k,l,m=0,n=a.type==='FeatureCollection',o=a.type==='Feature',p=n?a.features.length:1;for(c=0;c<p;c++){h=n?a.features[c].geometry:o?a.geometry:a;j=n?a.features[c].properties:o?a.properties:{};k=n?a.features[c].bbox:o?a.bbox:undefined;l=n?a.features[c].id:o?a.id:undefined;i=h?h.type==='GeometryCollection':!1;g=i?h.geometries.length:1;for(e=0;e<g;e++){f=i?h.geometries[e]:h;if(f===null){if(b(null,m,j,k,l)===!1)return !1;continue}switch(f.type){case 'Point':;case 'LineString':;case 'MultiPoint':;case 'Polygon':;case 'MultiLineString':;case 'MultiPolygon':{if(b(f,m,j,k,l)===!1)return !1;break};case 'GeometryCollection':{for(d=0;d<f.geometries.length;d++){if(b(f.geometries[d],m,j,k,l)===!1)return !1}break};default:throw new Error('Unknown Geometry Type')}}m++}}function H(a,b){G(a,function(a,c,d,e,f){var g=a===null?null:a.type;switch(g){case null:;case 'Point':;case 'LineString':;case 'Polygon':if(b(m(a,d,{bbox:e,id:f}),c,0)===!1)return !1;return};var h;switch(g){case 'MultiPoint':h='Point';break;case 'MultiLineString':h='LineString';break;case 'MultiPolygon':h='Polygon';break};for(var i=0;i<a.coordinates.length;i++){var j=a.coordinates[i],k={type:h,coordinates:j};if(b(m(k,d),c,i)===!1)return !1}})}function I(a,b){if(!a)throw new Error('geojson is required');H(a,function(a,c,d){if(a.geometry===null)return;var e=a.geometry.type,f=a.geometry.coordinates;switch(e){case 'LineString':if(b(a,c,d,0,0)===!1)return !1;break;case 'Polygon':for(var g=0;g<f.length;g++){if(b(q(f[g],a.properties),c,d,g)===!1)return !1};break}})}function J(a){if(!a){throw new Error('coord is required')}if(!Array.isArray(a)){if(a.type==='Feature'&&a.geometry!==null&&a.geometry.type==='Point'){return a.geometry.coordinates}if(a.type==='Point'){return a.coordinates}}if(Array.isArray(a)&&a.length>=2&&!Array.isArray(a[0])&&!Array.isArray(a[1])){return a}throw new Error('coord must be GeoJSON Point or an Array of numbers')}function K(a){if(Array.isArray(a)){return a}if(a.type==='Feature'){if(a.geometry!==null){return a.geometry.coordinates}}else{if(a.coordinates){return a.coordinates}}throw new Error('coords must be GeoJSON Feature, Geometry Object or an Array')}var $=Number.EPSILON;$===undefined&&($=Math.pow(2,-52));function aD(a){if(!a){throw new Error('geojson is required')}switch(a.type){case 'Feature':return aE(a);case 'FeatureCollection':return aG(a);case 'Point':;case 'LineString':;case 'Polygon':;case 'MultiPoint':;case 'MultiLineString':;case 'MultiPolygon':;case 'GeometryCollection':return aH(a);default:throw new Error('unknown GeoJSON type')}}function aE(a){var b={type:'Feature'};Object.keys(a).forEach(function(c){switch(c){case 'type':;case 'properties':;case 'geometry':return;default:b[c]=a[c]}});b.properties=aF(a.properties);b.geometry=aH(a.geometry);return b}function aF(a){var b={};if(!a){return b}Object.keys(a).forEach(function(c){var d=a[c];e(d)==='object'?(d===null?(b[c]=null):Array.isArray(d)?(b[c]=d.map(function(a){return a})):(b[c]=aF(d))):(b[c]=d)});return b}function aG(a){var b={type:'FeatureCollection'};Object.keys(a).forEach(function(c){switch(c){case 'type':;case 'features':return;default:b[c]=a[c]}});b.features=a.features.map(function(a){return aE(a)});return b}function aH(a){var b={type:a.type};a.bbox&&(b.bbox=a.bbox);if(a.type==='GeometryCollection'){b.geometries=a.geometries.map(function(a){return aH(a)});return b}b.coordinates=aI(a.coordinates);return b}function aI(a){var b=a;if(e(b[0])!=='object'){return b.slice()}return b.map(function(a){return aI(a)})}function aJ(a,b,c,d){d=D(d);var e=J(a),f=B(e[0]),g=B(e[1]),h=B(c),i=u(b,d.units),j=Math.asin(Math.sin(g)*Math.cos(i)+Math.cos(g)*Math.sin(i)*Math.cos(h)),k=f+Math.atan2(Math.sin(h)*Math.sin(i)*Math.cos(g),Math.cos(i)-Math.sin(g)*Math.sin(j)),l=A(k),m=A(j);return o([l,m],d.properties)}function aK(a,b,c){c=D(c);var d=c.steps||64,e=c.properties?c.properties:!Array.isArray(a)&&a.type==='Feature'&&a.properties?a.properties:{},f=[];for(var g=0;g<d;g++)f.push(aJ(a,b,g*-360/d,c).geometry.coordinates);f.push(f[0]);return p([f],e)}function aL(a,b,c){c=D(c);if(c.final===!0){return aM(a,b)}var d=J(a),e=J(b),f=B(d[0]),g=B(e[0]),h=B(d[1]),i=B(e[1]),j=Math.sin(g-f)*Math.cos(i),k=Math.cos(h)*Math.sin(i)-Math.sin(h)*Math.cos(i)*Math.cos(g-f);return A(Math.atan2(j,k))}function aM(a,b){var c=aL(b,a);c=(c+180)%360;return c}function aN(a){var b=null,c=null,d={type:'FeatureCollection',features:[]};a.type==='Feature'?(c=a.geometry):(c=a);if(c.type==='LineString')b=[c.coordinates];else if(c.type==='MultiLineString')b=c.coordinates;else if(c.type==='MultiPolygon')b=[].concat.apply([],c.coordinates);else if(c.type==='Polygon')b=c.coordinates;else{throw new Error("Input must be a LineString, MultiLineString, Polygon, or MultiPolygon Feature or Geometry")};b.forEach(function(a){b.forEach(function(b){for(var c=0;c<a.length-1;c++){for(var e=c;e<b.length-1;e++){if(a===b){if(Math.abs(c-e)===1){continue}if(c===0&&e===a.length-2&&a[c][0]===a[a.length-1][0]&&a[c][1]===a[a.length-1][1]){continue}}var f=aO(a[c][0],a[c][1],a[c+1][0],a[c+1][1],b[e][0],b[e][1],b[e+1][0],b[e+1][1]);f&&d.features.push(o([f[0],f[1]]))}}})});return d}function aO(a,b,c,d,e,f,g,h){var i,j,k,l,m,n={x:null,y:null,onLine1:!1,onLine2:!1};i=(h-f)*(c-a)-(g-e)*(d-b);if(i===0){if(n.x!==null&&n.y!==null){return n}else{return !1}}j=b-f;k=a-e;l=(g-e)*j-(h-f)*k;m=(c-a)*j-(d-b)*k;j=l/i;k=m/i;n.x=a+j*(c-a);n.y=b+j*(d-b);j>=0&&j<=1&&(n.onLine1=!0);k>=0&&k<=1&&(n.onLine2=!0);if(n.onLine1&&n.onLine2){return[n.x,n.y]}else{return !1}}function aR(a,b,c,d,e){e=D(e);var f=e.steps||64,g=aS(c),h=aS(d),i=!Array.isArray(a)&&a.type==='Feature'?a.properties:{};if(g===h){return q(aK(a,b,e).geometry.coordinates[0],i)}var j=g,k=g<h?h:h+360,l=(k-j)/f,m=j,n=[],o=0;while(m<k)n.push(aJ(a,b,m,{units:e.units}).geometry.coordinates),o++,m=j+o*l;m>k&&n.push(aJ(a,b,k,{units:e.units}).geometry.coordinates);return q(n,i)}function aS(a){var b=a%360;b<0&&(b+=360);return b}function aT(a,b){return b={exports:{}}, a(b,b.exports), b.exports}var aU=aT(function(a,b){b=a.exports=typeof Object.keys==='function'?Object.keys:c;b.shim=c;function c(a){var b=[];for(var c in a)b.push(c);return b}});function bc(a){var b=K(a),c=0,d=1,e,f;while(d<b.length)e=f||b[0],f=b[d],c+=(f[0]-e[0])*(f[1]+e[1]),d++;return c>0}function bd(a,b){b=b||{};if(!C(b))throw new Error('options is invalid');var c=b.reverse||!1,d=b.mutate||!1;if(!a)throw new Error('<geojson> is required');if(typeof c!=='boolean')throw new Error('<reverse> must be a boolean');if(typeof d!=='boolean')throw new Error('<mutate> must be a boolean');d===!1&&(a=aD(a));var e=[];switch(a.type){case 'GeometryCollection':G(a,function(a){be(a,c)});return a;case 'FeatureCollection':F(a,function(a){F(be(a,c),function(a){e.push(a)})});return r(e)};return be(a,c)}function be(a,b){var c=a.type==='Feature'?a.geometry.type:a.type;switch(c){case 'GeometryCollection':G(a,function(a){be(a,b)});return a;case 'LineString':bf(K(a),b);return a;case 'Polygon':bg(K(a),b);return a;case 'MultiLineString':K(a).forEach(function(a){bf(a,b)});return a;case 'MultiPolygon':K(a).forEach(function(a){bg(a,b)});return a;case 'Point':;case 'MultiPoint':return a}}function bf(a,b){bc(a)===b&&a.reverse()}function bg(a,b){bc(a[0])!==b&&a[0].reverse();for(var c=1;c<a.length;c++)bc(a[c])===b&&a[c].reverse()}var bh={eudist:function d(a,b,c){var e=a.length,f=0;for(var g=0;g<e;g++){var h=(a[g]||0)-(b[g]||0);f+=h*h}return c?Math.sqrt(f):f},mandist:function d(a,b,c){var e=a.length,f=0;for(var g=0;g<e;g++)f+=Math.abs((a[g]||0)-(b[g]||0));return c?Math.sqrt(f):f},dist:function d(a,b,c){var e=Math.abs(a-b);return c?e:e*e}},bi=bh.eudist,bj=bh.mandist,bk=bh.dist,bl=Object.freeze({default:bh,__moduleExports:bh,eudist:bi,mandist:bj,dist:bk}),bm=bl&&bh||bl,bo=bm.dist;function bz(a,b,c){var d=Math.sqrt((a[0]-b[0])*(a[0]-b[0])+(a[1]-b[1])*(a[1]-b[1])),e=a[0]+c*(b[1]-a[1])/d,f=b[0]+c*(b[1]-a[1])/d,g=a[1]+c*(a[0]-b[0])/d,h=b[1]+c*(a[0]-b[0])/d;return[[e,g],[f,h]]}function bA(a,b,c,d,e,f,g,h){var i,j,k,l,m,n;n={x:null,y:null,onLine1:!1,onLine2:!1};i=(h-f)*(c-a)-(g-e)*(d-b);if(i===0)return n;j=b-f;k=a-e;l=(g-e)*j-(h-f)*k;m=(c-a)*j-(d-b)*k;j=l/i;k=m/i;n.x=a+j*(c-a);n.y=b+j*(d-b);j>0&&j<1&&(n.onLine1=!0);return n}function bB(a){return a>0?-Math.abs(a):Math.abs(a)}function bC(a,b,c,d,e,f){switch(a){case 'round':return bE(b,c,d,e,f)}}function bD(a,b,c,d,e,f){switch(a){case 'round':return bE(b,c,d,e,f);case 'square':return bF();case 'flat':return bG(b)}}function bE(a,b,c,d,e){var f=aR(o(a),b,c+90,d-90,{steps:e,units:'degrees'});return f.geometry.coordinates.reverse()}function bF(){return[]}function bG(a){return[]}function bH(a,b,c,d,e){var f=[[]],g=a.type;if(g==='MultiLineString'){for(var h=1;h<a.coordinates.length;h++)f.push([])}I(a,function(a,d,e,g){f[e].push(bI(a,b,c))});return g==='LineString'?p(f[0]):s(f)}function bI(a,b,c){var d=K(a),e=[],f=[],g=null,h=d[1],i=null;E(a,function(a,j){if(j===0){var k=aL(o(a),o(h)),l=bD('round',a,b,k,k,c);e=e.concat(l)}else if(j===d.length-1){g=d[j-1];var m=aL(o(a),o(g));i=bD('round',a,b,m,m,c)}else{g=d[j-1];h=d[j+1];var n=aL(o(a),o(g)),p=aL(o(a),o(h)),q=z(z(p)-z(n));if(q<180){var r=bC('round',a,b,p,n,c);e=e.concat(r);var s=bz(a,h,-Math.abs(b)),t=bz(g,a,-Math.abs(b)),u=bA(s[0][0],s[0][1],s[1][0],s[1][1],t[0][0],t[0][1],t[1][0],t[1][1]);f.push([u.x,u.y])}else{var v=bz(a,h,b),w=bz(g,a,b),x=bA(v[0][0],v[0][1],v[1][0],v[1][1],w[0][0],w[0][1],w[1][0],w[1][1]);e.push([x.x,x.y]);var y=bC('round',a,b,n,p,c);f=f.concat(y.reverse())}}});e=e.concat(i);e=e.concat(f.reverse());e.push(e[0]);return e}function bJ(a,b,c){var d=[[]],e=a.type;if(e==='MultiPolygon'){for(var f=1;f<a.coordinates.length;f++)d.push([])}I(a,function(a,e,f,g){g===0?(bc(a.geometry.coordinates)&&(a=bd(a,{reverse:!0})),d[f].push(bK(a,b,c))):(bc(a.geometry.coordinates)||(a=bd(a,{reverse:!0})),d[f].push(bK(a,bB(b),c)))});return e==='Polygon'?p(d[0]):s(d)}function bK(a,b,c){var d=K(a),e=[];E(a,function(a,f){if(f>0){var g=d[f-1],h=f===d.length-1?d[1]:d[f+1],i=aL(o(a),o(g)),j=aL(o(a),o(h)),k=z(z(j)-z(i));if(k<180){var l=bC('round',a,b,j,i,c);e=e.concat(l)}else{var m=bz(a,h,b),n=bz(g,a,b),p=bA(m[0][0],m[0][1],m[1][0],m[1][1],n[0][0],n[0][1],n[1][0],n[1][1]);e.push([p.x,p.y])}}});e.push(e[0]);return e}function bL(a,b,c){return aK(a,b,{steps:c,units:'degrees'})}var bM=function c(a,b){f(this,c);this.key=a;this.data=b;this.left=null;this.right=null};function bN(a,b){return a>b?1:a<b?-1:0}function bO(a,b,c){if(b===null)return b;var d,e,f,g=new bM();d=e=g;while(!0){var h=c(a,b.key);if(h<0){if(b.left===null)break;if(c(a,b.left.key)<0){f=b.left;b.left=f.right;f.right=b;b=f;if(b.left===null)break}e.left=b;e=b;b=b.left}else if(h>0){if(b.right===null)break;if(c(a,b.right.key)>0){f=b.right;b.right=f.left;f.left=b;b=f;if(b.right===null)break}d.right=b;d=b;b=b.right}else{break}}d.right=b.left;e.left=b.right;b.left=g.right;b.right=g.left;return b}function bP(a,b,c,d,e){var f=new bM(a,b);e._size++;if(c===null){f.left=f.right=null;return f}c=bO(a,c,d);var g=d(a,c.key);g<0?(f.left=c.left,f.right=c,c.left=null):g>=0&&(f.right=c.right,f.left=c,c.right=null);return f}function bQ(a,b,c,d,e){var f=new bM(a,b);if(c===null){f.left=f.right=null;e._size++;return f}c=bO(a,c,d);var g=d(a,c.key);if(g===0)return c;else{g<0?(f.left=c.left,f.right=c,c.left=null):g>0&&(f.right=c.right,f.left=c,c.right=null);e._size++;return f}}function bR(a,b,c,d){var e;if(b===null)return null;b=bO(a,b,c);var f=c(a,b.key);if(f===0){b.left===null?(e=b.right):(e=bO(a,b.left,c),e.right=b.right);d._size--;return e}return b}function bS(a,b,c){var d,e;if(b===null)d=e=null;else{b=bO(a,b,c);var f=c(b.key,a);f===0?(d=b.left,e=b.right):f<0?(e=b.right,b.right=null,d=b):(d=b.left,b.left=null,e=b)}return{left:d,right:e}}function bT(a,b,c){if(b===null)return a;if(a===null)return b;b=bO(a.key,b,c);b.left=a;return b}function bU(a,b,c,d,e){if(a){d("".concat(b).concat(c?'└── ':'├── ').concat(e(a),"\n"));var f=b+(c?'    ':'│   ');a.left&&bU(a.left,f,!1,d,e);a.right&&bU(a.right,f,!0,d,e)}}var bV=function(){function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:bN;f(this,a);this._comparator=b;this._root=null;this._size=0}j(a,[{key:"insert",value:function c(a,b){return this._root=bP(a,b,this._root,this._comparator,this)}},{key:"add",value:function c(a,b){return this._root=bQ(a,b,this._root,this._comparator,this)}},{key:"remove",value:function b(a){this._root=bR(a,this._root,this._comparator,this)}},{key:"pop",value:function a(){var b=this._root;if(b){while(b.left)b=b.left;this._root=bO(b.key,this._root,this._comparator);this._root=bR(b.key,this._root,this._comparator,this);return{key:b.key,data:b.data}}return null}},{key:"findStatic",value:function b(a){var c=this._root,d=this._comparator;while(c){var e=d(a,c.key);if(e===0)return c;else e<0?(c=c.left):(c=c.right)}return null}},{key:"find",value:function b(a){if(this._root){this._root=bO(a,this._root,this._comparator);if(this._comparator(a,this._root.key)!==0)return null}return this._root}},{key:"contains",value:function b(a){var c=this._root,d=this._comparator;while(c){var e=d(a,c.key);if(e===0)return !0;else e<0?(c=c.left):(c=c.right)}return !1}},{key:"forEach",value:function c(a,b){var d=this._root,e=[],f=!1;while(!f)d!==null?(e.push(d),d=d.left):e.length!==0?(d=e.pop(),a.call(b,d),d=d.right):(f=!0);return this}},{key:"range",value:function e(a,b,c,d){var f=[],g=this._comparator,h=this._root,i;while(f.length!==0||h){if(h)f.push(h),h=h.left;else{h=f.pop();i=g(h.key,b);if(i>0){break}else if(g(h.key,a)>=0){if(c.call(d,h))return this};h=h.right}}return this}},{key:"keys",value:function(){var a=[];this.forEach(function(b){var c=b.key;return a.push(c)});return a}},{key:"values",value:function(){var a=[];this.forEach(function(b){var c=b.data;return a.push(c)});return a}},{key:"min",value:function a(){if(this._root)return this.minNode(this._root).key;return null}},{key:"max",value:function a(){if(this._root)return this.maxNode(this._root).key;return null}},{key:"minNode",value:function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this._root;if(b)while(b.left)b=b.left;return b}},{key:"maxNode",value:function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this._root;if(b)while(b.right)b=b.right;return b}},{key:"at",value:function b(a){var c=this._root,d=!1,e=0,f=[];while(!d){if(c)f.push(c),c=c.left;else{if(f.length>0){c=f.pop();if(e===a)return c;e++;c=c.right}else d=!0}}return null}},{key:"next",value:function b(a){var c=this._root,d=null;if(a.right){d=a.right;while(d.left)d=d.left;return d}var e=this._comparator;while(c){var f=e(a.key,c.key);if(f===0)break;else f<0?(d=c,c=c.left):(c=c.right)}return d}},{key:"prev",value:function b(a){var c=this._root,d=null;if(a.left!==null){d=a.left;while(d.right)d=d.right;return d}var e=this._comparator;while(c){var f=e(a.key,c.key);if(f===0)break;else f<0?(c=c.left):(d=c,c=c.right)}return d}},{key:"clear",value:function a(){this._root=null;this._size=0;return this}},{key:"toList",value:function a(){return bY(this._root)}},{key:"load",value:function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[],c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[],d=arguments.length>2&&arguments[2]!==undefined?arguments[2]:!1,e=b.length,f=this._comparator;d&&b$(b,c,0,e-1,f);if(this._root===null)this._root=bW(this._root,b,c,0,e),this._size=e;else{var g=b_(this.toList(),bX(b,c),f);e=this._size+e;this._root=bZ({head:g},0,e)}return this}},{key:"isEmpty",value:function a(){return this._root===null}},{key:"toString",value:function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:function(a){return a.key},c=[];bU(this._root,'',!0,function(a){return c.push(a)},b);return c.join('')}},{key:"update",value:function d(a,b,c){var e=this._comparator,f=bS(a,this._root,e),g=f.left,h=f.right;this._size--;e(a,b)<0?(h=bP(b,c,h,e,this)):(g=bP(b,c,g,e,this));this._root=bT(g,h,e)}},{key:"split",value:function b(a){return bS(a,this._root,this._comparator)}},{key:"size",get:function a(){return this._size}}]);return a}();function bW(a,b,c,d,e){var f=e-d;if(f>0){var g=d+Math.floor(f/2),h=b[g],i=c[g],j={key:h,data:i,parent:a};j.left=bW(j,b,c,d,g);j.right=bW(j,b,c,g+1,e);return j}return null}function bX(a,b){var c={next:null},d=c;for(var e=0;e<a.length;e++)d=d.next={key:a[e],data:b[e]};d.next=null;return c.next}function bY(a){var b=a,c=[],d=!1,e={next:null},f=e;while(!d)b?(c.push(b),b=b.left):c.length>0?(b=f=f.next=c.pop(),b=b.right):(d=!0);f.next=null;return e.next}function bZ(a,b,c){var d=c-b;if(d>0){var e=b+Math.floor(d/2),f=bZ(a,b,e),g=a.head;g.left=f;a.head=a.head.next;g.right=bZ(a,e+1,c);return g}return null}function b_(c,d){var e=arguments.length>2&&arguments[2]!==undefined?arguments[2]:function(a,b){return a-b},f={},g=f,h=c,i=d;while(h!==null&&i!==null)e(h.key,i.key)<0?(g.next=h,h=h.next):(g.next=i,i=i.next),g=g.next;h!==null?(g.next=h):i!==null&&(g.next=i);return f.next}function b$(a,b,c,d,e){if(c>=d)return;var f=a[c+d>>1],g=c-1,h=d+1;while(!0){do{g++}while(e(a[g],f)<0);do{h--}while(e(a[h],f)>0);if(g>=h)break;var i=a[g];a[g]=a[h];a[h]=i;i=b[g];b[g]=b[h];b[h]=i}b$(a,b,c,h,e);b$(a,b,h+1,d,e)}var ca=Number.EPSILON;ca===undefined&&(ca=Math.pow(2,-52));var cb=ca*ca,cc=function c(a,b){if(-ca<a&&a<ca){if(-ca<b&&b<ca){return 0}}if((a-b)*(a-b)<cb*a*b){return 0}return a<b?-1:1},cd=function c(a,b){if(a===b)return 0;var d=a.x,e=b.x;if(d<=-ca||ca<=d||e<=-ca||ca<=e){var f=d-e;if(f*f>=cb*d*e){return d<e?-1:1}}d=a.y;e=b.y;if(d<=-ca||ca<=d||e<=-ca||ca<=e){var g=d-e;if(g*g>=cb*d*e){return d<e?-1:1}}return 0},ce=function c(a,b){return a.x*b.y-a.y*b.x},cf=function c(a,b){return a.x*b.x+a.y*b.y},cg=function d(a,b,c){var e={x:b.x-a.x,y:b.y-a.y},f={x:c.x-a.x,y:c.y-a.y},g=ce(e,f);return cc(g,0)},ch=function b(a){return Math.sqrt(cf(a,a))},ci=function d(a,b,c){var e={x:b.x-a.x,y:b.y-a.y},f={x:c.x-a.x,y:c.y-a.y};return ce(f,e)/ch(f)/ch(e)},cj=function d(a,b,c){var e={x:b.x-a.x,y:b.y-a.y},f={x:c.x-a.x,y:c.y-a.y};return cf(f,e)/ch(f)/ch(e)},ck=function d(a,b,c){if(b.y===0)return null;return{x:a.x+b.x/b.y*(c-a.y),y:c}},cl=function d(a,b,c){if(b.x===0)return null;return{x:c,y:a.y+b.y/b.x*(c-a.x)}},cm=function e(a,b,c,d){if(b.x===0)return cl(c,d,a.x);if(d.x===0)return cl(a,b,c.x);if(b.y===0)return ck(c,d,a.y);if(d.y===0)return ck(a,b,c.y);var f=ce(b,d);if(f==0)return null;var g={x:c.x-a.x,y:c.y-a.y},h=ce(g,b)/f,i=ce(g,d)/f,j=(a.x+i*b.x+c.x+h*d.x)/2,k=(a.y+i*b.y+c.y+h*d.y)/2;return{x:j,y:k}},cn=function b(a){return{x:-a.y,y:a.x}},co=function b(a){var c=[];if(!Array.isArray(a)){throw new Error('Input is not a Polygon or MultiPolygon')}for(var d=0,e=a.length;d<e;d++){if(!Array.isArray(a[d])||a[d].length==0){throw new Error('Input is not a Polygon or MultiPolygon')}c.push([]);for(var f=0,g=a[d].length;f<g;f++){if(!Array.isArray(a[d][f])||a[d][f].length==0){throw new Error('Input is not a Polygon or MultiPolygon')}if(Array.isArray(a[d][f][0])){c[d].push([]);for(var h=0,i=a[d][f].length;h<i;h++){if(!Array.isArray(a[d][f][h])||a[d][f][h].length<2){throw new Error('Input is not a Polygon or MultiPolygon')}if(a[d][f][h].length>2){throw new Error("Input has more than two coordinates. Only 2-dimensional polygons supported.")}c[d][f].push({x:a[d][f][h][0],y:a[d][f][h][1]})}}else{if(a[d][f].length<2){throw new Error('Input is not a Polygon or MultiPolygon')}if(a[d][f].length>2){throw new Error("Input has more than two coordinates. Only 2-dimensional polygons supported.")}c[d].push({x:a[d][f][0],y:a[d][f][1]})}}}return c},cp=function b(a){if(Array.isArray(a)){if(a.length===0)return;if(Array.isArray(a[0])){if(Array.isArray(a[0][0])){if(typeof a[0][0][0].x==='number'&&typeof a[0][0][0].y==='number'){return}}if(typeof a[0][0].x==='number'&&typeof a[0][0].y==='number'){a.unshift(a.splice(0));return}}}throw new Error('Unrecognized input - not a polygon nor multipolygon')},cq=function b(a){var c=0;while(c<a.length){var d=a[c];if(d.length===0){a.splice(c,1);continue}var e=d[0];cr(e);if(e.length===0){a.splice(c,1);continue}var f=1;while(f<d.length){var g=d[f];cr(g);g.length===0?d.splice(f,1):f++}c++}},cr=function b(a){if(a.length===0)return;cd(a[0],a[a.length-1])===0&&a.pop();var c=function d(a,b,c){return cd(a,b)===0||cd(b,c)===0||cg(b,a,c)===0},d=0,e,f;while(d<a.length)e=d===0?a[a.length-1]:a[d-1],f=d===a.length-1?a[0]:a[d+1],c(e,a[d],f)?a.splice(d,1):d++;while(a.length<3&&a.length>0)a.pop()},cs=function(){function a(){f(this,a);this.types={INTERSECTION:0,UNION:1,XOR:2,DIFFERENCE:3}}j(a,[{key:"register",value:function c(a,b){this.type=a;this.numMultiPolys=b}}]);return a}(),ct=new cs(),cu=function(){j(c,null,[{key:"compare",value:function c(a,b){if(a.point!==b.point){var d=cc(a.point.x,b.point.x);if(d!==0)return d;var e=cc(a.point.y,b.point.y);if(e!==0)return e;a.link(b)}if(a.isLeft!==b.isLeft)return a.isLeft?1:-1;if(a.segment.isVertical&&!b.segment.isVertical)return a.isLeft?1:-1;if(!a.segment.isVertical&&b.segment.isVertical)return a.isLeft?-1:1;var f=a.segment.comparePoint(b.otherSE.point);if(f!==0)return f>0?-1:1;var g=a.segment.ringIn.id,h=b.segment.ringIn.id;if(g!==h)return g<h?-1:1;if(a===b)return 0;throw new Error("SweepEvent comparison failed at [".concat(a.point.x,", ").concat(a.point.y,"]... ")+"equal but not identical?")}}]);function c(a){f(this,c);a.events===undefined?(a.events=[this]):a.events.push(this);this.point=a}j(c,[{key:"link",value:function b(a){if(a.point===this.point){throw new Error("Tried to link already linked events")}var c=this.point.events.length,d=a.point.events;for(var e=0,f=d.length;e<f;e++){var g=d[e];this.point.events.push(g);g.point=this.point;for(var h=0,i=c;h<i;h++)this.point.events[h].otherSE.point===g.otherSE.point&&this.point.events[h].segment.registerCoincident(g.segment)}}},{key:"getAvailableLinkedEvents",value:function a(){var b=[];for(var c=0,d=this.point.events.length;c<d;c++){var e=this.point.events[c];e!==this&&!e.segment.ringOut&&e.segment.isInResult&&b.push(e)}return b}},{key:"getLeftmostComparator",value:function d(c){var e=this,f=new Map(),g=function b(a){var d=a.otherSE;f.set(a,{sine:ci(e.point,c.point,d.point),cosine:cj(e.point,c.point,d.point)})};return function(a,b){f.has(a)||g(a);f.has(b)||g(b);var c=f.get(a),d=c.sine,e=c.cosine,h=f.get(b),i=h.sine,j=h.cosine,k=cc(d,0),l=cc(i,0);if(k>=0&&l>=0)return cc(j,e);if(k<0&&l<0)return cc(e,j);return cc(i,d)}}},{key:"isLeft",get:function a(){return this===this.segment.leftSE}},{key:"isRight",get:function a(){return this===this.segment.rightSE}},{key:"isOrientationCorrect",get:function a(){var b=cd(this.point,this.otherSE.point);if(b<0)return this.isLeft;if(b>0)return this.isRight;throw new Error("Degenerate segment encountered")}},{key:"otherSE",get:function a(){return this.segment.getOtherSE(this)}}]);return c}(),cv=function c(a,b){var d=a.ll.x,e=a.ll.y,f=a.ur.x,g=a.ur.y,h=b.x,i=b.y;return cc(d,h)<=0&&cc(h,f)<=0&&cc(e,i)<=0&&cc(i,g)<=0},cw=function c(a,b){return!(cc(b.ur.x,a.ll.x)<0||cc(a.ur.x,b.ll.x)<0||cc(b.ur.y,a.ll.y)<0||cc(a.ur.y,b.ll.y)<0)},cx=function c(a,b){if(!cw(a,b))return null;var d=a.ll.x<b.ll.x?b.ll.x:a.ll.x,e=a.ur.x<b.ur.x?a.ur.x:b.ur.x,f=a.ll.y<b.ll.y?b.ll.y:a.ll.y,g=a.ur.y<b.ur.y?a.ur.y:b.ur.y;return{ll:{x:d,y:f},ur:{x:e,y:g}}},cy=function b(a){var c=a.ll.x,d=a.ll.y,e=a.ur.x,f=a.ur.y,g=cc(c,e)===0,h=cc(d,f)===0;if(g&&h)return[{x:c,y:d}];if(g)return[{x:c,y:d},{x:c,y:f}];if(h)return[{x:c,y:d},{x:e,y:d}];return[{x:c,y:d},{x:c,y:f},{x:e,y:d},{x:e,y:f}]},cz=function(){j(c,null,[{key:"compare",value:function c(a,b){if(a===b)return 0;var d=a.leftSE.point.x,e=a.leftSE.point.y,f=b.leftSE.point.x,g=b.leftSE.point.y,h=a.rightSE.point.x,i=b.rightSE.point.x;if(cc(i,d)<0)return 1;if(cc(h,f)<0)return-1;var j=a.comparePoint(b.leftSE.point),k=cc(d,f);if(j===0&&a.comparePoint(b.rightSE.point)===0&&b.comparePoint(a.leftSE.point)===0&&b.comparePoint(a.rightSE.point)===0){if(k!==0)return k;if(a.ringIn.id!==b.ringIn.id){return a.ringIn.id<b.ringIn.id?-1:1}}else{if(k<0)return j===1?-1:1;if(k>0)return b.comparePoint(a.leftSE.point)===1?1:-1;var l=cc(e,g);if(l===0){if(a.isVertical!==b.isVertical)return a.isVertical?1:-1;else return a.comparePoint(b.rightSE.point)>0?-1:1}return l}throw new Error("Segment comparison (from [".concat(a.leftSE.point.x,", ").concat(a.leftSE.point.y,"])")+" -> to [".concat(a.rightSE.point.x,", ").concat(a.rightSE.point.y,"]) failed... ")+" segments equal but not identical?")}}]);function c(a,b,d){f(this,c);this.leftSE=a;a!==null&&(a.segment=this);this.rightSE=b;b!==null&&(b.segment=this);this.ringIn=d;this.ringOut=null;this.coincidents=[this];this._clearCache()}j(c,[{key:"swapEvents",value:function a(){var b=this.leftSE;this.leftSE=this.rightSE;this.rightSE=b}},{key:"getOtherSE",value:function b(a){if(a===this.leftSE)return this.rightSE;if(a===this.rightSE)return this.leftSE;throw new Error('may only be called by own sweep events')}},{key:"isAnEndpoint",value:function b(a){return cd(a,this.leftSE.point)===0||cd(a,this.rightSE.point)===0}},{key:"isPointOn",value:function b(a){return cv(this.bbox,a)&&this.comparePoint(a)===0}},{key:"comparePoint",value:function b(a){if(this.isAnEndpoint(a))return 0;var c=this.vector,d=cn(c),e=cm(this.leftSE.point,c,a,d),f=cc(a.y,e.y);if(f!==0)return f;return cc(e.x,a.x)}},{key:"getIntersections",value:function b(a){var c=cx(this.bbox,a.bbox);if(c===null)return[];var d=[],e=cy(c);for(var f=0,g=e.length;f<g;f++){var h=e[f];(this.isAnEndpoint(h)&&a.isPointOn(h)||a.isAnEndpoint(h)&&this.isPointOn(h))&&d.push(h)}if(d.length>0)return d;var i=cm(this.leftSE.point,this.vector,a.leftSE.point,a.vector);if(i!==null&&cv(c,i))return[i];return[]}},{key:"split",value:function b(a){a.sort(cd);var d=[];for(var e=0;e<a.length;e++)(e===0||cd(a[e-1],a[e])!==0)&&d.push(a[e]);a=d;for(var f=0,g=a.length;f<g;f++){var h=a[f];if(this.isAnEndpoint(h)){throw new Error("Cannot split segment upon endpoint at [".concat(h.x,", ").concat(h.y,"]"))}}var i=a.shift(),j=[],k=[];for(var l=0,m=this.coincidents.length;l<m;l++){var n=this.coincidents[l],o=new cu(i),p=new cu(i);j.push(new c(o,n.rightSE,n.ringIn));n.rightSE=p;n.rightSE.segment=n;k.push(p);k.push(o)}for(var q=1,r=j.length;q<r;q++)j[q].registerCoincident(j[q-1]);if(a.length>0){var s=j[0].split(a);for(var t=0,u=s.length;t<u;t++)k.push(s[t])}return k}},{key:"registerPrev",value:function b(a){this.prev=a;this._clearCache()}},{key:"registerRingOut",value:function b(a){this.ringOut=a}},{key:"registerCoincident",value:function d(c){if(this.coincidents==c.coincidents)return;var e=c.coincidents;for(var f=0,g=e.length;f<g;f++){var h=e[f];this.coincidents.push(h);h.coincidents=this.coincidents}this.coincidents.sort(function(a,b){return a.ringIn.id-b.ringIn.id})}},{key:"_prevInResult",value:function a(){var b=this.prev;while(b&&!b.isInResult)b=b.prev;return b}},{key:"_prevNotCoincident",value:function a(){var b=this,c=this.prev;while(c&&b.coincidents===c.coincidents)b=c,c=c.prev;return c}},{key:"_sweepLineEntersRing",value:function a(){var b=this.prevNotCoincident;while(b){for(var c=0,d=b.coincidents.length;c<d;c++){var e=b.coincidents[c];if(e.ringIn===this.ringIn)return!e.sweepLineEntersRing}b=b.prevNotCoincident}return !0}},{key:"_ringsInsideOf",value:function a(){if(!this.prev)return[];if(this.coincidents===this.prev.coincidents){return this.prev.ringsInsideOf}var b=[],c=this.prev.ringsInsideOf,d=this.prev.getRingsEntering(),e=this.getRingsExiting();for(var f=0,g=c.length;f<g;f++){var h=c[f];e.includes(h)||b.push(h)}for(var i=0,j=d.length;i<j;i++){var k=d[i];e.includes(k)||b.push(k)}return b}},{key:"getRingsOnEdgeOf",value:function a(){var b=[];for(var c=0,d=this.coincidents.length;c<d;c++)b.push(this.coincidents[c].ringIn);return b}},{key:"getRingsEntering",value:function a(){var b=[];for(var c=0,d=this.coincidents.length;c<d;c++){var e=this.coincidents[c];if(!e.sweepLineEntersRing)continue;b.push(e.ringIn)}return b}},{key:"getRingsExiting",value:function a(){var b=[];for(var c=0,d=this.coincidents.length;c<d;c++){var e=this.coincidents[c];if(e.sweepLineEntersRing)continue;b.push(e.ringIn)}return b}},{key:"getRingsEnteringAndExiting",value:function a(){var b=[],c=[];for(var d=0,e=this.coincidents.length;d<e;d++){var f=this.coincidents[d];f.sweepLineEntersRing?b.push(f.ringIn):c.push(f.ringIn)}return[b,c]}},{key:"_isValidEdgeForPoly",value:function a(){var b,c,d=this.getRingsEnteringAndExiting();this.sweepLineEntersRing?(b=d[0],c=d[1]):(c=d[0],b=d[1]);return this.ringIn.isValid(b,c,this.ringsInsideOf)}},{key:"getMultiPolysInsideOf",value:function a(){var b=[];for(var c=0,d=this.ringsInsideOf.length;c<d;c++){var e=this.ringsInsideOf[c].poly;if(b.includes(e.multiPoly))continue;if(!e.isInside(this.getRingsOnEdgeOf(),this.ringsInsideOf))continue;b.push(e.multiPoly)}return b}},{key:"getMultiPolysSLPEntersAndExits",value:function b(a){var c=a.slice(0),d=a.slice(0);for(var e=0,f=this.coincidents.length;e<f;e++){var g=this.coincidents[e],h=g.ringIn.poly.multiPoly;g.sweepLineEntersPoly?(c.includes(h)||c.push(h)):g.sweepLineExitsPoly&&(d.includes(h)||d.push(h))}return[c,d]}},{key:"_isInResult",value:function a(){if(this!==this.coincidents[0])return !1;var b=this.getMultiPolysInsideOf(),c=this.getMultiPolysSLPEntersAndExits(b),d=c[0],e=c[1];switch(ct.type){case ct.types.UNION:var k=d.length===0;var j=e.length===0;return k!==j;case ct.types.INTERSECTION:var i;var h;d.length<e.length?(i=d.length,h=e.length):(i=e.length,h=d.length);return h===ct.numMultiPolys&&i<h;case ct.types.XOR:var g=Math.abs(d.length-e.length);return g%2===1;case ct.types.DIFFERENCE:var f=function b(a){return a.length===1&&a[0].isSubject};return f(d)!==f(e);default:throw new Error("Unrecognized operation type found ".concat(ct.type))}}},{key:"_clearCache",value:function a(){this._cache={}}},{key:"bbox",get:function a(){var b=this.leftSE.point.y,c=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:b<c?b:c},ur:{x:this.rightSE.point.x,y:b>c?b:c}}}},{key:"vector",get:function a(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isVertical",get:function a(){return cc(this.leftSE.point.x,this.rightSE.point.x)===0}},{key:"prevInResult",get:function a(){var b='prevInResult';this._cache[b]===undefined&&(this._cache[b]=this["_".concat(b)]());return this._cache[b]}},{key:"prevNotCoincident",get:function a(){var b='prevNotCoincident';this._cache[b]===undefined&&(this._cache[b]=this["_".concat(b)]());return this._cache[b]}},{key:"sweepLineEntersRing",get:function a(){var b='sweepLineEntersRing';this._cache[b]===undefined&&(this._cache[b]=this["_".concat(b)]());return this._cache[b]}},{key:"sweepLineEntersPoly",get:function a(){if(!this.isValidEdgeForPoly)return !1;return this.ringIn.isExterior===this.sweepLineEntersRing}},{key:"sweepLineExitsPoly",get:function a(){if(!this.isValidEdgeForPoly)return !1;return this.ringIn.isExterior!==this.sweepLineEntersRing}},{key:"ringsInsideOf",get:function a(){var b='ringsInsideOf';this._cache[b]===undefined&&(this._cache[b]=this["_".concat(b)]());return this._cache[b]}},{key:"isValidEdgeForPoly",get:function a(){var b='isValidEdgeForPoly';this._cache[b]===undefined&&(this._cache[b]=this["_".concat(b)]());return this._cache[b]}},{key:"isInResult",get:function a(){var b='isInResult';this._cache[b]===undefined&&(this._cache[b]=this["_".concat(b)]());return this._cache[b]}}],[{key:"fromRing",value:function e(a,b,d){var f,g,h=cd(a,b);if(h<0)f=new cu(a),g=new cu(b);else if(h>0)f=new cu(b),g=new cu(a);else{throw new Error("Tried to create degenerate segment at [".concat(a.x,", ").concat(b.y,"]"))};return new c(f,g,d)}}]);return c}(),cA=0,cB=function(){function a(b,c){f(this,a);this.id=cA++;this.poly=c;this.segments=[];var d=b[0];for(var e=1,g=b.length;e<g;e++){var h=b[e];this.segments.push(cz.fromRing(d,h,this));d=h}this.segments.push(cz.fromRing(d,b[0],this))}j(a,[{key:"getSweepEvents",value:function a(){var b=[];for(var c=0,d=this.segments.length;c<d;c++){var e=this.segments[c];b.push(e.leftSE);b.push(e.rightSE)}return b}},{key:"isValid",value:function d(a,b,c){var e=this.poly.exteriorRing,f=this.poly.interiorRings;if(this===e){for(var g=0,h=c.length;g<h;g++){if(f.includes(c[g]))return !1}for(var i=0,j=a.length;i<j;i++){if(f.includes(a[i]))return !1}return !0}if(!c.includes(e)){if(!b.includes(e))return !1}for(var k=0,l=c.length;k<l;k++){if(f.includes(c[k]))return !1}for(var m=0,n=b.length;m<n;m++){if(f.includes(b[m]))return !1}return !0}},{key:"isExterior",get:function a(){return this.poly.exteriorRing===this}},{key:"isInterior",get:function a(){return this.poly.exteriorRing!==this}}]);return a}(),cC=function(){function a(b,c){f(this,a);this.exteriorRing=new cB(b[0],this);this.interiorRings=[];for(var d=1,e=b.length;d<e;d++)this.interiorRings.push(new cB(b[d],this));this.multiPoly=c}j(a,[{key:"getSweepEvents",value:function a(){var b=this.exteriorRing.getSweepEvents();for(var c=0,d=this.interiorRings.length;c<d;c++){var e=this.interiorRings[c].getSweepEvents();for(var f=0,g=e.length;f<g;f++)b.push(e[f])}return b}},{key:"isInside",value:function c(a,b){for(var d=0,e=a.length;d<e;d++){if(a[d].poly===this)return !1}var f=!1;for(var g=0,h=b.length;g<h;g++){var i=b[g];if(i.poly!==this)continue;if(i.isInterior)return !1;f=!0}return f}}]);return a}(),cD=function(){function a(b){f(this,a);this.polys=[];for(var c=0,d=b.length;c<d;c++)this.polys.push(new cC(b[c],this));this.isSubject=!1}j(a,[{key:"markAsSubject",value:function a(){this.isSubject=!0}},{key:"getSweepEvents",value:function a(){var b=[];for(var c=0,d=this.polys.length;c<d;c++){var e=this.polys[c].getSweepEvents();for(var f=0,g=e.length;f<g;f++)b.push(e[f])}return b}}]);return a}(),cE=function(){j(a,null,[{key:"factory",value:function c(b){var d=[];for(var e=0,f=b.length;e<f;e++){var g=b[e];if(!g.isInResult||g.ringOut)continue;var h=null,i=g.leftSE,j=g.rightSE,k=[i],l=i.point,m=[];while(!0){h=i;i=j;k.push(i);if(i.point===l)break;while(!0){var n=i.getAvailableLinkedEvents();if(n.length===0){var o=k[0].point,p=k[k.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(o.x,",")+" ".concat(o.y,"]. Last matching segment found ends at")+" [".concat(p.x,", ").concat(p.y,"]."))}if(n.length===1){j=n[0].otherSE;break}var q=null;for(var r=0,s=m.length;r<s;r++){if(m[r].point===i.point){q=r;break}}if(q!==null){var t=m.splice(q)[0],u=k.splice(t.index);u.unshift(u[0].otherSE);d.push(new a(u.reverse()));continue}m.push({index:k.length,point:i.point});var v=i.getLeftmostComparator(h);j=n.sort(v)[0].otherSE;break}}d.push(new a(k))}return d}}]);function a(b){f(this,a);this.events=b;for(var c=0,d=b.length;c<d;c++)b[c].segment.registerRingOut(this);this.poly=null;this._clearCache()}j(a,[{key:"registerPoly",value:function b(a){this.poly=a}},{key:"getGeom",value:function a(){var b=[[this.events[0].point.x,this.events[0].point.y]];for(var c=1,d=this.events.length-1;c<d;c++){var e=this.events[c-1].point,f=this.events[c].point,g=this.events[c+1].point;if(cg(f,e,g)===0)continue;b.push([f.x,f.y])}var h=this.events[this.events.length-2].point,i=this.events[0].point,j=this.events[1].point;cg(i,h,j)===0&&b.shift();if(b.length===0)return null;b.push(b[0]);return this.isExteriorRing?b:b.reverse()}},{key:"_clearCache",value:function a(){this._cache={}}},{key:"_getCached",value:function c(a,b){this._cache[a]===undefined&&(this._cache[a]=this["_".concat(a)].bind(this)());return this._cache[a]}},{key:"_isExteriorRing",value:function a(){if(!this.enclosingRing)return !0;if(!this.enclosingRing.enclosingRing)return !1;return this.enclosingRing.enclosingRing.isExteriorRing}},{key:"_enclosingRing",value:function a(){var b=this.events[0];for(var c=1,d=this.events.length;c<d;c++){var e=this.events[c];cu.compare(b,e)>0&&(b=e)}var f=b.segment.prevInResult,g=f?f.prevInResult:null;while(!0){if(!f)return null;if(!g)return f.ringOut;if(g.ringOut!==f.ringOut){if(g.ringOut.enclosingRing!==f.ringOut){return f.ringOut}else return f.ringOut.enclosingRing}f=g.prevInResult;g=f?f.prevInResult:null}}},{key:"enclosingRing",get:function a(){return this._getCached('enclosingRing')}},{key:"isExteriorRing",get:function a(){return this._getCached('isExteriorRing')}}]);return a}(),cF=function(){function a(b){f(this,a);this.exteriorRing=b;b.registerPoly(this);this.interiorRings=[]}j(a,[{key:"addInterior",value:function b(a){this.interiorRings.push(a);a.registerPoly(this)}},{key:"getGeom",value:function a(){var b=[this.exteriorRing.getGeom()];if(b[0]===null)return null;for(var c=0,d=this.interiorRings.length;c<d;c++){var e=this.interiorRings[c].getGeom();if(e===null)continue;b.push(e)}return b}}]);return a}(),cG=function(){function a(b){f(this,a);this.rings=b;this.polys=this._composePolys(b)}j(a,[{key:"getGeom",value:function a(){var b=[];for(var c=0,d=this.polys.length;c<d;c++){var e=this.polys[c].getGeom();if(e===null)continue;b.push(e)}return b}},{key:"_composePolys",value:function b(a){var c=[];for(var d=0,e=a.length;d<e;d++){var f=a[d];if(f.poly)continue;f.isExteriorRing?c.push(new cF(f)):(f.enclosingRing.poly||c.push(new cF(f.enclosingRing)),f.enclosingRing.poly.addInterior(f))}return c}}]);return a}(),cH=function(){function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:cz.compare;f(this,a);this.tree=new bV(b);this.segments=[]}j(a,[{key:"process",value:function b(a){var c=a.segment,d=[],e=a.isLeft?this.tree.insert(c):this.tree.find(c),f=this.tree.prev(e),g=f?f.key:null,h=this.tree.next(e),i=h?h.key:null;if(a.isLeft){var j=[];if(g){var k=g.getIntersections(c);if(k.length>0){var l=this._possibleSplit(g,k);for(var m=0,n=l.length;m<n;m++)d.push(l[m]);for(var o=0,p=k.length;o<p;o++){var q=k[o];c.isAnEndpoint(q)||j.push(q)}}}if(i){var r=i.getIntersections(c);if(r.length>0){var s=this._possibleSplit(i,r);for(var t=0,u=s.length;t<u;t++)d.push(s[t]);for(var v=0,w=r.length;v<w;v++){var x=r[v];c.isAnEndpoint(x)||j.push(x)}}}if(d.length>0||j.length>0){this.tree.remove(c);if(j.length>0){var y=c.split(j);for(var z=0,A=y.length;z<A;z++)d.push(y[z])}d.push(a)}else this.segments.push(c),c.registerPrev(g)}else{if(g&&i){var B=g.getIntersections(i);if(B.length>0){var C=this._possibleSplit(g,B);for(var D=0,E=C.length;D<E;D++)d.push(C[D]);C=this._possibleSplit(i,B);for(var F=0,G=C.length;F<G;F++)d.push(C[F])}}this.tree.remove(c)}for(var H=0,I=d.length;H<I;H++){var J=d[H];J.isOrientationCorrect||J.segment.swapEvents()}return d}},{key:"_possibleSplit",value:function c(a,b){var d=[];for(var e=0,f=b.length;e<f;e++){var g=b[e];a.isAnEndpoint(g)||d.push(g)}var h=[];if(d.length>0){var i=[];for(var j=0,k=a.coincidents.length;j<k;j++){var l=this.tree.find(a.coincidents[j]);l!==null&&(i.push(l),this.tree.remove(l.key))}h=a.split(d);for(var m=0,n=i.length;m<n;m++)this.tree.insert(i[m].key)}return h}}]);return a}();function cI(a,b,c){var d=[co(b)];for(var e=0,f=c.length;e<f;e++)d.push(co(c[e]));for(var g=0,h=d.length;g<h;g++)cp(d[g]),cq(d[g]);var i=[];for(var j=0,k=d.length;j<k;j++)i.push(new cD(d[j]));i[0].markAsSubject();ct.register(a,i.length);var l=new bV(cu.compare);for(var m=0,n=i.length;m<n;m++){var o=i[m].getSweepEvents();for(var p=0,q=o.length;p<q;p++)l.insert(o[p])}var r=new cH(),s;while(s=l.pop()){var t=r.process(s.key);for(var u=0,v=t.length;u<v;u++)l.insert(t[u])}var w=cE.factory(r.segments),x=new cG(w);return x.getGeom()}var cJ=function b(a){for(var c=arguments.length,d=new Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];return cI(ct.types.UNION,a,d)},cK=function b(a){for(var c=arguments.length,d=new Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];return cI(ct.types.INTERSECTION,a,d)},cL=function b(a){for(var c=arguments.length,d=new Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];return cI(ct.types.XOR,a,d)},cM=function b(a){for(var c=arguments.length,d=new Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];return cI(ct.types.DIFFERENCE,a,d)},cN={union:cJ,intersection:cK,xor:cL,difference:cM};function cO(a,b,c,d){if(!a)throw new Error('feature is required');if(b===undefined||b===null||isNaN(b))throw new Error('distance is required');var e=d||64,f=a.properties||{},g=a.type==='Feature'?a.geometry:a,h=w(b,c),i=null;switch(g.type){case 'Polygon':;case 'MultiPolygon':i=bJ(g,h,e);break;case 'LineString':;case 'MultiLineString':i=bH(g,h,e);cP(i)&&(i=cN.union(i.geometry.coordinates),i=g.type==='LineString'?p(i[0]):s(i));break;case 'Point':i=bL(g,h,e)};i.properties=f;return i}function cP(a){var b=aN(a);if(b.features.length>0)return !0;return !1}c.bufferGeoJSON=cO;Object.defineProperty(c,'__esModule',{value:!0})}))
