!function(a,b){typeof exports==='object'&&typeof module!=='undefined'?b(exports):typeof define==='function'&&define.amd?define(['exports'],b):(b((a.geojsonBuffer={})))}(this,(function(c){'use strict';function f(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function g(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value" in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}function h(a,b,c){b&&g(a.prototype,b);c&&g(a,c);return a}var j=6371008.8,k={centimeters:j*100,centimetres:j*100,degrees:180/Math.PI,feet:j*3.28084,inches:j*39.370,kilometers:j/1000,kilometres:j/1000,meters:j,metres:j,miles:j/1609.344,millimeters:j*1000,millimetres:j*1000,nauticalmiles:j/1852,radians:1,yards:j/1.0936};function l(a,b,c){c=B(c);var d={type:'Feature'};(c.id===0||c.id)&&(d.id=c.id);c.bbox&&(d.bbox=c.bbox);d.properties=b||{};d.geometry=a;return d}function m(a,b,c){c=B(c);var d={type:'Point',coordinates:a};return l(d,b,c)}function o(a,b,c){c=B(c);var d=!0,e=!1,f=undefined;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=!0){var i=h.value;if(i.length<4){throw new Error('Each LinearRing of a Polygon must have 4 or more Positions.')}for(var j=0;j<i[i.length-1].length;j++){if(i[i.length-1][j]!==i[0][j]){throw new Error('First and last Position are not equivalent.')}}}}catch(a){e=!0,f=a}finally{try{!d&&g.return!=null&&g.return()}finally{if(e){throw f}}};var k={type:'Polygon',coordinates:a};return l(k,b,c)}function p(a,b,c){c=B(c);if(a.length<2){throw new Error('coordinates must be an array of two or more positions')}var d={type:'LineString',coordinates:a};return l(d,b,c)}function q(a,b,c){c=B(c);var d={type:'MultiPolygon',coordinates:a};return l(d,b,c)}function r(a,b){if(a===undefined||a===null)throw new Error('distance is required');if(b&&typeof b!=='string')throw new Error('units must be a string');var c=k[b||'kilometers'];if(!c){throw new Error(b+' units is invalid')}return a/c}function s(a,b){b===null&&(b='kilometers');return w(r(a,b))}function u(a){if(a===null||a===undefined)throw new Error('bearing is required');var b=a%360;b<0&&(b+=360);return b}function w(a){if(a===null||a===undefined)throw new Error('radians is required');var b=a%(2*Math.PI);return b*180/Math.PI}function z(a){if(a===null||a===undefined)throw new Error('degrees is required');var b=a%360;return b*Math.PI/180}function A(a){return!!a&&a.constructor===Object}function B(a){a=a||{};if(!A(a))throw new Error('options is invalid');return a}function C(a,b,c){if(a===null)return;var d,e,f,g,h,i,j,k=0,l=0,m,n=a.type,o=n==='FeatureCollection',p=n==='Feature',q=o?a.features.length:1;for(var r=0;r<q;r++){j=o?a.features[r].geometry:p?a.geometry:a;m=j?j.type==='GeometryCollection':!1;h=m?j.geometries.length:1;for(var s=0;s<h;s++){var t=0,u=0;g=m?j.geometries[s]:j;if(g===null)continue;i=g.coordinates;var v=g.type;k=c&&(v==='Polygon'||v==='MultiPolygon')?1:0;switch(v){case null:break;case 'Point':if(b(i,l,r,t,u)===!1)return !1;l++;t++;break;case 'LineString':;case 'MultiPoint':for(d=0;d<i.length;d++){if(b(i[d],l,r,t,u)===!1)return !1;l++;v==='MultiPoint'&&t++};v==='LineString'&&t++;break;case 'Polygon':;case 'MultiLineString':for(d=0;d<i.length;d++){for(e=0;e<i[d].length-k;e++){if(b(i[d][e],l,r,t,u)===!1)return !1;l++}v==='MultiLineString'&&t++;v==='Polygon'&&u++};v==='Polygon'&&t++;break;case 'MultiPolygon':for(d=0;d<i.length;d++){u=0;for(e=0;e<i[d].length;e++){for(f=0;f<i[d][e].length-k;f++){if(b(i[d][e][f],l,r,t,u)===!1)return !1;l++}u++}t++};break;case 'GeometryCollection':for(d=0;d<g.geometries.length;d++){if(C(g.geometries[d],b,c)===!1)return !1};break;default:throw new Error('Unknown Geometry Type')}}}}function D(a,b){var c,d,e,f,g,h,i,j,k,l,m=0,n=a.type==='FeatureCollection',o=a.type==='Feature',p=n?a.features.length:1;for(c=0;c<p;c++){h=n?a.features[c].geometry:o?a.geometry:a;j=n?a.features[c].properties:o?a.properties:{};k=n?a.features[c].bbox:o?a.bbox:undefined;l=n?a.features[c].id:o?a.id:undefined;i=h?h.type==='GeometryCollection':!1;g=i?h.geometries.length:1;for(e=0;e<g;e++){f=i?h.geometries[e]:h;if(f===null){if(b(null,m,j,k,l)===!1)return !1;continue}switch(f.type){case 'Point':;case 'LineString':;case 'MultiPoint':;case 'Polygon':;case 'MultiLineString':;case 'MultiPolygon':{if(b(f,m,j,k,l)===!1)return !1;break};case 'GeometryCollection':{for(d=0;d<f.geometries.length;d++){if(b(f.geometries[d],m,j,k,l)===!1)return !1}break};default:throw new Error('Unknown Geometry Type')}}m++}}function E(a,b){D(a,function(a,c,d,e,f){var g=a===null?null:a.type;switch(g){case null:;case 'Point':;case 'LineString':;case 'Polygon':if(b(l(a,d,{bbox:e,id:f}),c,0)===!1)return !1;return};var h;switch(g){case 'MultiPoint':h='Point';break;case 'MultiLineString':h='LineString';break;case 'MultiPolygon':h='Polygon';break};for(var i=0;i<a.coordinates.length;i++){var j=a.coordinates[i],k={type:h,coordinates:j};if(b(l(k,d),c,i)===!1)return !1}})}function F(a,b){if(!a)throw new Error('geojson is required');E(a,function(a,c,d){if(a.geometry===null)return;var e=a.geometry.type,f=a.geometry.coordinates;switch(e){case 'LineString':if(b(a,c,d,0,0)===!1)return !1;break;case 'Polygon':for(var g=0;g<f.length;g++){if(b(p(f[g],a.properties),c,d,g)===!1)return !1};break}})}function G(a){if(!a){throw new Error('coord is required')}if(!Array.isArray(a)){if(a.type==='Feature'&&a.geometry!==null&&a.geometry.type==='Point'){return a.geometry.coordinates}if(a.type==='Point'){return a.coordinates}}if(Array.isArray(a)&&a.length>=2&&!Array.isArray(a[0])&&!Array.isArray(a[1])){return a}throw new Error('coord must be GeoJSON Point or an Array of numbers')}function H(a){if(Array.isArray(a)){return a}if(a.type==='Feature'){if(a.geometry!==null){return a.geometry.coordinates}}else{if(a.coordinates){return a.coordinates}}throw new Error('coords must be GeoJSON Feature, Geometry Object or an Array')}var Y=Number.EPSILON;Y===undefined&&(Y=Math.pow(2,-52));function aA(a,b,c,d){d=B(d);var e=G(a),f=z(e[0]),g=z(e[1]),h=z(c),i=r(b,d.units),j=Math.asin(Math.sin(g)*Math.cos(i)+Math.cos(g)*Math.sin(i)*Math.cos(h)),k=f+Math.atan2(Math.sin(h)*Math.sin(i)*Math.cos(g),Math.cos(i)-Math.sin(g)*Math.sin(j)),l=w(k),n=w(j);return m([l,n],d.properties)}function aB(a,b,c){c=B(c);var d=c.steps||64,e=c.properties?c.properties:!Array.isArray(a)&&a.type==='Feature'&&a.properties?a.properties:{},f=[];for(var g=0;g<d;g++)f.push(aA(a,b,g*-360/d,c).geometry.coordinates);f.push(f[0]);return o([f],e)}function aC(a,b,c){c=B(c);if(c.final===!0){return aD(a,b)}var d=G(a),e=G(b),f=z(d[0]),g=z(e[0]),h=z(d[1]),i=z(e[1]),j=Math.sin(g-f)*Math.cos(i),k=Math.cos(h)*Math.sin(i)-Math.sin(h)*Math.cos(i)*Math.cos(g-f);return w(Math.atan2(j,k))}function aD(a,b){var c=aC(b,a);c=(c+180)%360;return c}function aE(a){var b=null,c=null,d={type:'FeatureCollection',features:[]};a.type==='Feature'?(c=a.geometry):(c=a);if(c.type==='LineString')b=[c.coordinates];else if(c.type==='MultiLineString')b=c.coordinates;else if(c.type==='MultiPolygon')b=[].concat.apply([],c.coordinates);else if(c.type==='Polygon')b=c.coordinates;else{throw new Error("Input must be a LineString, MultiLineString, Polygon, or MultiPolygon Feature or Geometry")};b.forEach(function(a){b.forEach(function(b){for(var c=0;c<a.length-1;c++){for(var e=c;e<b.length-1;e++){if(a===b){if(Math.abs(c-e)===1){continue}if(c===0&&e===a.length-2&&a[c][0]===a[a.length-1][0]&&a[c][1]===a[a.length-1][1]){continue}}var f=aF(a[c][0],a[c][1],a[c+1][0],a[c+1][1],b[e][0],b[e][1],b[e+1][0],b[e+1][1]);f&&d.features.push(m([f[0],f[1]]))}}})});return d}function aF(a,b,c,d,e,f,g,h){var i,j,k,l,m,n={x:null,y:null,onLine1:!1,onLine2:!1};i=(h-f)*(c-a)-(g-e)*(d-b);if(i===0){if(n.x!==null&&n.y!==null){return n}else{return !1}}j=b-f;k=a-e;l=(g-e)*j-(h-f)*k;m=(c-a)*j-(d-b)*k;j=l/i;k=m/i;n.x=a+j*(c-a);n.y=b+j*(d-b);j>=0&&j<=1&&(n.onLine1=!0);k>=0&&k<=1&&(n.onLine2=!0);if(n.onLine1&&n.onLine2){return[n.x,n.y]}else{return !1}}function aI(a,b){return b={exports:{}}, a(b,b.exports), b.exports}var aJ=aI(function(a,b){b=a.exports=typeof Object.keys==='function'?Object.keys:c;b.shim=c;function c(a){var b=[];for(var c in a)b.push(c);return b}});function aT(a){var b=H(a),c=0,d=1,e,f;while(d<b.length)e=f||b[0],f=b[d],c+=(f[0]-e[0])*(f[1]+e[1]),d++;return c>0}var aU={eudist:function d(a,b,c){var e=a.length,f=0;for(var g=0;g<e;g++){var h=(a[g]||0)-(b[g]||0);f+=h*h}return c?Math.sqrt(f):f},mandist:function d(a,b,c){var e=a.length,f=0;for(var g=0;g<e;g++)f+=Math.abs((a[g]||0)-(b[g]||0));return c?Math.sqrt(f):f},dist:function d(a,b,c){var e=Math.abs(a-b);return c?e:e*e}},aV=aU.eudist,aW=aU.mandist,aX=aU.dist,aY=Object.freeze({default:aU,__moduleExports:aU,eudist:aV,mandist:aW,dist:aX}),aZ=aY&&aU||aY,a$=aZ.dist;function bk(a,b,c){var d=Math.sqrt((a[0]-b[0])*(a[0]-b[0])+(a[1]-b[1])*(a[1]-b[1])),e=a[0]+c*(b[1]-a[1])/d,f=b[0]+c*(b[1]-a[1])/d,g=a[1]+c*(a[0]-b[0])/d,h=b[1]+c*(a[0]-b[0])/d;return[[e,g],[f,h]]}function bl(a,b,c,d,e,f,g,h){var i,j,k,l,m,n;n={x:null,y:null,onLine1:!1,onLine2:!1};i=(h-f)*(c-a)-(g-e)*(d-b);if(i===0)return n;j=b-f;k=a-e;l=(g-e)*j-(h-f)*k;m=(c-a)*j-(d-b)*k;j=l/i;k=m/i;n.x=a+j*(c-a);n.y=b+j*(d-b);j>0&&j<1&&(n.onLine1=!0);return n}function bm(a){return a>0?-Math.abs(a):Math.abs(a)}function bn(a,b,c,d,e,f){switch(a){case 'round':return bp(b,c,d,e,f)}}function bo(a,b,c,d,e,f){switch(a){case 'round':return bp(b,c,d,e,f);case 'square':return br();case 'flat':return bs(b)}}function bp(a,b,c,d,e){var f=bq(a,b,aA(a,b,d-90).geometry.coordinates,aA(a,b,c+90).geometry.coordinates,e,!1);return f}function bq(a,b,c,d,e,f){var g=[],h=Math.PI*2,i=Math.atan2(c[1]-a[1],c[0]-a[0]),j=Math.atan2(d[1]-a[1],d[0]-a[0]);i<0&&(i+=h);j<0&&(j+=h);var k=i>j?i-j:i+h-j,l=(h-k)/e;for(var m=1;m<e+1;++m)k=i+l*m,g.push([a[0]+Math.cos(k)*b,a[1]+Math.sin(k)*b]);return g}function br(){return[]}function bs(a){return[]}function bt(a,b,c,d,e){var f=[[]],g=a.type;if(g==='MultiLineString'){for(var h=1;h<a.coordinates.length;h++)f.push([])}F(a,function(a,d,e,g){f[e].push(bu(a,b,c))});return f.length===1?o(f[0]):q(f)}function bu(a,b,c){var d=H(a),e=[],f=[],g=null,h=d[1],i=null;C(a,function(a,j){if(j===0){var k=aC(m(a),m(h)),l=bo('round',a,b,k,k,c);e=e.concat(l)}else if(j===d.length-1){g=d[j-1];var n=aC(m(a),m(g));i=bo('round',a,b,n,n,c)}else{g=d[j-1];h=d[j+1];var o=aC(m(a),m(g)),p=aC(m(a),m(h)),q=u(u(p)-u(o));if(q<180){var r=bn('round',a,b,p,o,c);e=e.concat(r);var s=bk(a,h,-Math.abs(b)),t=bk(g,a,-Math.abs(b)),v=bl(s[0][0],s[0][1],s[1][0],s[1][1],t[0][0],t[0][1],t[1][0],t[1][1]);f.push([v.x,v.y])}else{var w=bk(a,h,b),x=bk(g,a,b),y=bl(w[0][0],w[0][1],w[1][0],w[1][1],x[0][0],x[0][1],x[1][0],x[1][1]);e.push([y.x,y.y]);var z=bn('round',a,b,o,p,c);f=f.concat(z.reverse())}}});e=e.concat(i);e=e.concat(f.reverse());e.push(e[0]);return e}function bv(a,b,c){var d=[],e=a.type,f=e==='Polygon'?[a.coordinates]:a.coordinates;for(var g=0;g<f.length;g++){var h=[];for(var i=0;i<f[g].length;i++){var j=f[g][i],k=i===0,l=k?b:bm(b),m=aT({type:'LineString',coordinates:j});h.push(bw(j,l,c,k,m))}d.push(h)}return d.length===1?o(d[0]):q(d)}function bw(a,b,c,d,e){var f=a,g=[],h=d&&!e;if(h){for(var i=1;i<f.length;i++){var j=f[i],k=f[i-1],l=i===f.length-1?f[1]:f[i+1];g=bx(j,k,l,b,c,g)}}else{for(var m=f.length-2;m>=0;m--){var n=f[m],o=f[m+1],p=m===0?f[f.length-2]:f[m-1];g=bx(n,o,p,b,c,g)}}g.push(g[0]);return g}function bx(a,b,c,d,e,f){var g=aC(m(a),m(b)),h=aC(m(a),m(c)),i=u(u(h)-u(g));if(i<180&&d>0){var j=bn('round',a,d,h,g,e);f=f.concat(j)}else{var k=bk(a,c,d),l=bk(b,a,d),n=bl(k[0][0],k[0][1],k[1][0],k[1][1],l[0][0],l[0][1],l[1][0],l[1][1]);f.push([n.x,n.y])}return f}function by(a,b,c){return aB(a,b,{steps:c,units:'degrees'})}var bz=function c(a,b){f(this,c);this.key=a;this.data=b;this.left=null;this.right=null};function bA(a,b){return a>b?1:a<b?-1:0}function bB(a,b,c){if(b===null)return b;var d,e,f,g=new bz();d=e=g;while(!0){var h=c(a,b.key);if(h<0){if(b.left===null)break;if(c(a,b.left.key)<0){f=b.left;b.left=f.right;f.right=b;b=f;if(b.left===null)break}e.left=b;e=b;b=b.left}else if(h>0){if(b.right===null)break;if(c(a,b.right.key)>0){f=b.right;b.right=f.left;f.left=b;b=f;if(b.right===null)break}d.right=b;d=b;b=b.right}else{break}}d.right=b.left;e.left=b.right;b.left=g.right;b.right=g.left;return b}function bC(a,b,c,d,e){var f=new bz(a,b);e._size++;if(c===null){f.left=f.right=null;return f}c=bB(a,c,d);var g=d(a,c.key);g<0?(f.left=c.left,f.right=c,c.left=null):g>=0&&(f.right=c.right,f.left=c,c.right=null);return f}function bD(a,b,c,d,e){var f=new bz(a,b);if(c===null){f.left=f.right=null;e._size++;return f}c=bB(a,c,d);var g=d(a,c.key);if(g===0)return c;else{g<0?(f.left=c.left,f.right=c,c.left=null):g>0&&(f.right=c.right,f.left=c,c.right=null);e._size++;return f}}function bE(a,b,c,d){var e;if(b===null)return null;b=bB(a,b,c);var f=c(a,b.key);if(f===0){b.left===null?(e=b.right):(e=bB(a,b.left,c),e.right=b.right);d._size--;return e}return b}function bF(a,b,c){var d,e;if(b===null)d=e=null;else{b=bB(a,b,c);var f=c(b.key,a);f===0?(d=b.left,e=b.right):f<0?(e=b.right,b.right=null,d=b):(d=b.left,b.left=null,e=b)}return{left:d,right:e}}function bG(a,b,c){if(b===null)return a;if(a===null)return b;b=bB(a.key,b,c);b.left=a;return b}function bH(a,b,c,d,e){if(a){d("".concat(b).concat(c?'└── ':'├── ').concat(e(a),"\n"));var f=b+(c?'    ':'│   ');a.left&&bH(a.left,f,!1,d,e);a.right&&bH(a.right,f,!0,d,e)}}var bI=function(){function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:bA;f(this,a);this._comparator=b;this._root=null;this._size=0}h(a,[{key:"insert",value:function c(a,b){return this._root=bC(a,b,this._root,this._comparator,this)}},{key:"add",value:function c(a,b){return this._root=bD(a,b,this._root,this._comparator,this)}},{key:"remove",value:function b(a){this._root=bE(a,this._root,this._comparator,this)}},{key:"pop",value:function a(){var b=this._root;if(b){while(b.left)b=b.left;this._root=bB(b.key,this._root,this._comparator);this._root=bE(b.key,this._root,this._comparator,this);return{key:b.key,data:b.data}}return null}},{key:"findStatic",value:function b(a){var c=this._root,d=this._comparator;while(c){var e=d(a,c.key);if(e===0)return c;else e<0?(c=c.left):(c=c.right)}return null}},{key:"find",value:function b(a){if(this._root){this._root=bB(a,this._root,this._comparator);if(this._comparator(a,this._root.key)!==0)return null}return this._root}},{key:"contains",value:function b(a){var c=this._root,d=this._comparator;while(c){var e=d(a,c.key);if(e===0)return !0;else e<0?(c=c.left):(c=c.right)}return !1}},{key:"forEach",value:function c(a,b){var d=this._root,e=[],f=!1;while(!f)d!==null?(e.push(d),d=d.left):e.length!==0?(d=e.pop(),a.call(b,d),d=d.right):(f=!0);return this}},{key:"range",value:function e(a,b,c,d){var f=[],g=this._comparator,h=this._root,i;while(f.length!==0||h){if(h)f.push(h),h=h.left;else{h=f.pop();i=g(h.key,b);if(i>0){break}else if(g(h.key,a)>=0){if(c.call(d,h))return this};h=h.right}}return this}},{key:"keys",value:function(){var a=[];this.forEach(function(b){var c=b.key;return a.push(c)});return a}},{key:"values",value:function(){var a=[];this.forEach(function(b){var c=b.data;return a.push(c)});return a}},{key:"min",value:function a(){if(this._root)return this.minNode(this._root).key;return null}},{key:"max",value:function a(){if(this._root)return this.maxNode(this._root).key;return null}},{key:"minNode",value:function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this._root;if(b)while(b.left)b=b.left;return b}},{key:"maxNode",value:function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this._root;if(b)while(b.right)b=b.right;return b}},{key:"at",value:function b(a){var c=this._root,d=!1,e=0,f=[];while(!d){if(c)f.push(c),c=c.left;else{if(f.length>0){c=f.pop();if(e===a)return c;e++;c=c.right}else d=!0}}return null}},{key:"next",value:function b(a){var c=this._root,d=null;if(a.right){d=a.right;while(d.left)d=d.left;return d}var e=this._comparator;while(c){var f=e(a.key,c.key);if(f===0)break;else f<0?(d=c,c=c.left):(c=c.right)}return d}},{key:"prev",value:function b(a){var c=this._root,d=null;if(a.left!==null){d=a.left;while(d.right)d=d.right;return d}var e=this._comparator;while(c){var f=e(a.key,c.key);if(f===0)break;else f<0?(c=c.left):(d=c,c=c.right)}return d}},{key:"clear",value:function a(){this._root=null;this._size=0;return this}},{key:"toList",value:function a(){return bL(this._root)}},{key:"load",value:function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[],c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[],d=arguments.length>2&&arguments[2]!==undefined?arguments[2]:!1,e=b.length,f=this._comparator;d&&bO(b,c,0,e-1,f);if(this._root===null)this._root=bJ(this._root,b,c,0,e),this._size=e;else{var g=bN(this.toList(),bK(b,c),f);e=this._size+e;this._root=bM({head:g},0,e)}return this}},{key:"isEmpty",value:function a(){return this._root===null}},{key:"toString",value:function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:function(a){return a.key},c=[];bH(this._root,'',!0,function(a){return c.push(a)},b);return c.join('')}},{key:"update",value:function d(a,b,c){var e=this._comparator,f=bF(a,this._root,e),g=f.left,h=f.right;this._size--;e(a,b)<0?(h=bC(b,c,h,e,this)):(g=bC(b,c,g,e,this));this._root=bG(g,h,e)}},{key:"split",value:function b(a){return bF(a,this._root,this._comparator)}},{key:"size",get:function a(){return this._size}}]);return a}();function bJ(a,b,c,d,e){var f=e-d;if(f>0){var g=d+Math.floor(f/2),h=b[g],i=c[g],j={key:h,data:i,parent:a};j.left=bJ(j,b,c,d,g);j.right=bJ(j,b,c,g+1,e);return j}return null}function bK(a,b){var c={next:null},d=c;for(var e=0;e<a.length;e++)d=d.next={key:a[e],data:b[e]};d.next=null;return c.next}function bL(a){var b=a,c=[],d=!1,e={next:null},f=e;while(!d)b?(c.push(b),b=b.left):c.length>0?(b=f=f.next=c.pop(),b=b.right):(d=!0);f.next=null;return e.next}function bM(a,b,c){var d=c-b;if(d>0){var e=b+Math.floor(d/2),f=bM(a,b,e),g=a.head;g.left=f;a.head=a.head.next;g.right=bM(a,e+1,c);return g}return null}function bN(c,d){var e=arguments.length>2&&arguments[2]!==undefined?arguments[2]:function(a,b){return a-b},f={},g=f,h=c,i=d;while(h!==null&&i!==null)e(h.key,i.key)<0?(g.next=h,h=h.next):(g.next=i,i=i.next),g=g.next;h!==null?(g.next=h):i!==null&&(g.next=i);return f.next}function bO(a,b,c,d,e){if(c>=d)return;var f=a[c+d>>1],g=c-1,h=d+1;while(!0){do{g++}while(e(a[g],f)<0);do{h--}while(e(a[h],f)>0);if(g>=h)break;var i=a[g];a[g]=a[h];a[h]=i;i=b[g];b[g]=b[h];b[h]=i}bO(a,b,c,h,e);bO(a,b,h+1,d,e)}var bP=Number.EPSILON;bP===undefined&&(bP=Math.pow(2,-52));var bQ=bP*bP,bR=function c(a,b){if(-bP<a&&a<bP){if(-bP<b&&b<bP){return 0}}if((a-b)*(a-b)<bQ*a*b){return 0}return a<b?-1:1},bS=function c(a,b){if(a===b)return 0;var d=a.x,e=b.x;if(d<=-bP||bP<=d||e<=-bP||bP<=e){var f=d-e;if(f*f>=bQ*d*e){return d<e?-1:1}}d=a.y;e=b.y;if(d<=-bP||bP<=d||e<=-bP||bP<=e){var g=d-e;if(g*g>=bQ*d*e){return d<e?-1:1}}return 0},bT=function c(a,b){return a.x*b.y-a.y*b.x},bU=function c(a,b){return a.x*b.x+a.y*b.y},bV=function d(a,b,c){var e={x:b.x-a.x,y:b.y-a.y},f={x:c.x-a.x,y:c.y-a.y},g=bT(e,f);return bR(g,0)},bW=function b(a){return Math.sqrt(bU(a,a))},bX=function d(a,b,c){var e={x:b.x-a.x,y:b.y-a.y},f={x:c.x-a.x,y:c.y-a.y};return bT(f,e)/bW(f)/bW(e)},bY=function d(a,b,c){var e={x:b.x-a.x,y:b.y-a.y},f={x:c.x-a.x,y:c.y-a.y};return bU(f,e)/bW(f)/bW(e)},bZ=function d(a,b,c){if(b.y===0)return null;return{x:a.x+b.x/b.y*(c-a.y),y:c}},b_=function d(a,b,c){if(b.x===0)return null;return{x:c,y:a.y+b.y/b.x*(c-a.x)}},b$=function e(a,b,c,d){if(b.x===0)return b_(c,d,a.x);if(d.x===0)return b_(a,b,c.x);if(b.y===0)return bZ(c,d,a.y);if(d.y===0)return bZ(a,b,c.y);var f=bT(b,d);if(f==0)return null;var g={x:c.x-a.x,y:c.y-a.y},h=bT(g,b)/f,i=bT(g,d)/f,j=(a.x+i*b.x+c.x+h*d.x)/2,k=(a.y+i*b.y+c.y+h*d.y)/2;return{x:j,y:k}},ca=function b(a){return{x:-a.y,y:a.x}},cb=function b(a){var c=[];if(!Array.isArray(a)){throw new Error('Input is not a Polygon or MultiPolygon')}for(var d=0,e=a.length;d<e;d++){if(!Array.isArray(a[d])||a[d].length==0){throw new Error('Input is not a Polygon or MultiPolygon')}c.push([]);for(var f=0,g=a[d].length;f<g;f++){if(!Array.isArray(a[d][f])||a[d][f].length==0){throw new Error('Input is not a Polygon or MultiPolygon')}if(Array.isArray(a[d][f][0])){c[d].push([]);for(var h=0,i=a[d][f].length;h<i;h++){if(!Array.isArray(a[d][f][h])||a[d][f][h].length<2){throw new Error('Input is not a Polygon or MultiPolygon')}if(a[d][f][h].length>2){throw new Error("Input has more than two coordinates. Only 2-dimensional polygons supported.")}c[d][f].push({x:a[d][f][h][0],y:a[d][f][h][1]})}}else{if(a[d][f].length<2){throw new Error('Input is not a Polygon or MultiPolygon')}if(a[d][f].length>2){throw new Error("Input has more than two coordinates. Only 2-dimensional polygons supported.")}c[d].push({x:a[d][f][0],y:a[d][f][1]})}}}return c},cc=function b(a){if(Array.isArray(a)){if(a.length===0)return;if(Array.isArray(a[0])){if(Array.isArray(a[0][0])){if(typeof a[0][0][0].x==='number'&&typeof a[0][0][0].y==='number'){return}}if(typeof a[0][0].x==='number'&&typeof a[0][0].y==='number'){a.unshift(a.splice(0));return}}}throw new Error('Unrecognized input - not a polygon nor multipolygon')},cd=function b(a){var c=0;while(c<a.length){var d=a[c];if(d.length===0){a.splice(c,1);continue}var e=d[0];ce(e);if(e.length===0){a.splice(c,1);continue}var f=1;while(f<d.length){var g=d[f];ce(g);g.length===0?d.splice(f,1):f++}c++}},ce=function b(a){if(a.length===0)return;bS(a[0],a[a.length-1])===0&&a.pop();var c=function d(a,b,c){return bS(a,b)===0||bS(b,c)===0||bV(b,a,c)===0},d=0,e,f;while(d<a.length)e=d===0?a[a.length-1]:a[d-1],f=d===a.length-1?a[0]:a[d+1],c(e,a[d],f)?a.splice(d,1):d++;while(a.length<3&&a.length>0)a.pop()},cf=function(){function a(){f(this,a);this.types={INTERSECTION:0,UNION:1,XOR:2,DIFFERENCE:3}}h(a,[{key:"register",value:function c(a,b){this.type=a;this.numMultiPolys=b}}]);return a}(),cg=new cf(),ch=function(){h(c,null,[{key:"compare",value:function c(a,b){if(a.point!==b.point){var d=bR(a.point.x,b.point.x);if(d!==0)return d;var e=bR(a.point.y,b.point.y);if(e!==0)return e;a.link(b)}if(a.isLeft!==b.isLeft)return a.isLeft?1:-1;if(a.segment.isVertical&&!b.segment.isVertical)return a.isLeft?1:-1;if(!a.segment.isVertical&&b.segment.isVertical)return a.isLeft?-1:1;var f=a.segment.comparePoint(b.otherSE.point);if(f!==0)return f>0?-1:1;var g=a.segment.ringIn.id,h=b.segment.ringIn.id;if(g!==h)return g<h?-1:1;if(a===b)return 0;throw new Error("SweepEvent comparison failed at [".concat(a.point.x,", ").concat(a.point.y,"]... ")+"equal but not identical?")}}]);function c(a){f(this,c);a.events===undefined?(a.events=[this]):a.events.push(this);this.point=a}h(c,[{key:"link",value:function b(a){if(a.point===this.point){throw new Error("Tried to link already linked events")}var c=this.point.events.length,d=a.point.events;for(var e=0,f=d.length;e<f;e++){var g=d[e];this.point.events.push(g);g.point=this.point;for(var h=0,i=c;h<i;h++)this.point.events[h].otherSE.point===g.otherSE.point&&this.point.events[h].segment.registerCoincident(g.segment)}}},{key:"getAvailableLinkedEvents",value:function a(){var b=[];for(var c=0,d=this.point.events.length;c<d;c++){var e=this.point.events[c];e!==this&&!e.segment.ringOut&&e.segment.isInResult&&b.push(e)}return b}},{key:"getLeftmostComparator",value:function d(c){var e=this,f=new Map(),g=function b(a){var d=a.otherSE;f.set(a,{sine:bX(e.point,c.point,d.point),cosine:bY(e.point,c.point,d.point)})};return function(a,b){f.has(a)||g(a);f.has(b)||g(b);var c=f.get(a),d=c.sine,e=c.cosine,h=f.get(b),i=h.sine,j=h.cosine,k=bR(d,0),l=bR(i,0);if(k>=0&&l>=0)return bR(j,e);if(k<0&&l<0)return bR(e,j);return bR(i,d)}}},{key:"isLeft",get:function a(){return this===this.segment.leftSE}},{key:"isRight",get:function a(){return this===this.segment.rightSE}},{key:"isOrientationCorrect",get:function a(){var b=bS(this.point,this.otherSE.point);if(b<0)return this.isLeft;if(b>0)return this.isRight;throw new Error("Degenerate segment encountered")}},{key:"otherSE",get:function a(){return this.segment.getOtherSE(this)}}]);return c}(),ci=function c(a,b){var d=a.ll.x,e=a.ll.y,f=a.ur.x,g=a.ur.y,h=b.x,i=b.y;return bR(d,h)<=0&&bR(h,f)<=0&&bR(e,i)<=0&&bR(i,g)<=0},cj=function c(a,b){return!(bR(b.ur.x,a.ll.x)<0||bR(a.ur.x,b.ll.x)<0||bR(b.ur.y,a.ll.y)<0||bR(a.ur.y,b.ll.y)<0)},ck=function c(a,b){if(!cj(a,b))return null;var d=a.ll.x<b.ll.x?b.ll.x:a.ll.x,e=a.ur.x<b.ur.x?a.ur.x:b.ur.x,f=a.ll.y<b.ll.y?b.ll.y:a.ll.y,g=a.ur.y<b.ur.y?a.ur.y:b.ur.y;return{ll:{x:d,y:f},ur:{x:e,y:g}}},cl=function b(a){var c=a.ll.x,d=a.ll.y,e=a.ur.x,f=a.ur.y,g=bR(c,e)===0,h=bR(d,f)===0;if(g&&h)return[{x:c,y:d}];if(g)return[{x:c,y:d},{x:c,y:f}];if(h)return[{x:c,y:d},{x:e,y:d}];return[{x:c,y:d},{x:c,y:f},{x:e,y:d},{x:e,y:f}]},cm=function(){h(c,null,[{key:"compare",value:function c(a,b){if(a===b)return 0;var d=a.leftSE.point.x,e=a.leftSE.point.y,f=b.leftSE.point.x,g=b.leftSE.point.y,h=a.rightSE.point.x,i=b.rightSE.point.x;if(bR(i,d)<0)return 1;if(bR(h,f)<0)return-1;var j=a.comparePoint(b.leftSE.point),k=bR(d,f);if(j===0&&a.comparePoint(b.rightSE.point)===0&&b.comparePoint(a.leftSE.point)===0&&b.comparePoint(a.rightSE.point)===0){if(k!==0)return k;if(a.ringIn.id!==b.ringIn.id){return a.ringIn.id<b.ringIn.id?-1:1}}else{if(k<0)return j===1?-1:1;if(k>0)return b.comparePoint(a.leftSE.point)===1?1:-1;var l=bR(e,g);if(l===0){if(a.isVertical!==b.isVertical)return a.isVertical?1:-1;else return a.comparePoint(b.rightSE.point)>0?-1:1}return l}throw new Error("Segment comparison (from [".concat(a.leftSE.point.x,", ").concat(a.leftSE.point.y,"])")+" -> to [".concat(a.rightSE.point.x,", ").concat(a.rightSE.point.y,"]) failed... ")+" segments equal but not identical?")}}]);function c(a,b,d){f(this,c);this.leftSE=a;a!==null&&(a.segment=this);this.rightSE=b;b!==null&&(b.segment=this);this.ringIn=d;this.ringOut=null;this.coincidents=[this];this._clearCache()}h(c,[{key:"swapEvents",value:function a(){var b=this.leftSE;this.leftSE=this.rightSE;this.rightSE=b}},{key:"getOtherSE",value:function b(a){if(a===this.leftSE)return this.rightSE;if(a===this.rightSE)return this.leftSE;throw new Error('may only be called by own sweep events')}},{key:"isAnEndpoint",value:function b(a){return bS(a,this.leftSE.point)===0||bS(a,this.rightSE.point)===0}},{key:"isPointOn",value:function b(a){return ci(this.bbox,a)&&this.comparePoint(a)===0}},{key:"comparePoint",value:function b(a){if(this.isAnEndpoint(a))return 0;var c=this.vector,d=ca(c),e=b$(this.leftSE.point,c,a,d),f=bR(a.y,e.y);if(f!==0)return f;return bR(e.x,a.x)}},{key:"getIntersections",value:function b(a){var c=ck(this.bbox,a.bbox);if(c===null)return[];var d=[],e=cl(c);for(var f=0,g=e.length;f<g;f++){var h=e[f];(this.isAnEndpoint(h)&&a.isPointOn(h)||a.isAnEndpoint(h)&&this.isPointOn(h))&&d.push(h)}if(d.length>0)return d;var i=b$(this.leftSE.point,this.vector,a.leftSE.point,a.vector);if(i!==null&&ci(c,i))return[i];return[]}},{key:"split",value:function b(a){a.sort(bS);var d=[];for(var e=0;e<a.length;e++)(e===0||bS(a[e-1],a[e])!==0)&&d.push(a[e]);a=d;for(var f=0,g=a.length;f<g;f++){var h=a[f];if(this.isAnEndpoint(h)){throw new Error("Cannot split segment upon endpoint at [".concat(h.x,", ").concat(h.y,"]"))}}var i=a.shift(),j=[],k=[];for(var l=0,m=this.coincidents.length;l<m;l++){var n=this.coincidents[l],o=new ch(i),p=new ch(i);j.push(new c(o,n.rightSE,n.ringIn));n.rightSE=p;n.rightSE.segment=n;k.push(p);k.push(o)}for(var q=1,r=j.length;q<r;q++)j[q].registerCoincident(j[q-1]);if(a.length>0){var s=j[0].split(a);for(var t=0,u=s.length;t<u;t++)k.push(s[t])}return k}},{key:"registerPrev",value:function b(a){this.prev=a;this._clearCache()}},{key:"registerRingOut",value:function b(a){this.ringOut=a}},{key:"registerCoincident",value:function d(c){if(this.coincidents==c.coincidents)return;var e=c.coincidents;for(var f=0,g=e.length;f<g;f++){var h=e[f];this.coincidents.push(h);h.coincidents=this.coincidents}this.coincidents.sort(function(a,b){return a.ringIn.id-b.ringIn.id})}},{key:"_prevInResult",value:function a(){var b=this.prev;while(b&&!b.isInResult)b=b.prev;return b}},{key:"_prevNotCoincident",value:function a(){var b=this,c=this.prev;while(c&&b.coincidents===c.coincidents)b=c,c=c.prev;return c}},{key:"_sweepLineEntersRing",value:function a(){var b=this.prevNotCoincident;while(b){for(var c=0,d=b.coincidents.length;c<d;c++){var e=b.coincidents[c];if(e.ringIn===this.ringIn)return!e.sweepLineEntersRing}b=b.prevNotCoincident}return !0}},{key:"_ringsInsideOf",value:function a(){if(!this.prev)return[];if(this.coincidents===this.prev.coincidents){return this.prev.ringsInsideOf}var b=[],c=this.prev.ringsInsideOf,d=this.prev.getRingsEntering(),e=this.getRingsExiting();for(var f=0,g=c.length;f<g;f++){var h=c[f];e.includes(h)||b.push(h)}for(var i=0,j=d.length;i<j;i++){var k=d[i];e.includes(k)||b.push(k)}return b}},{key:"getRingsOnEdgeOf",value:function a(){var b=[];for(var c=0,d=this.coincidents.length;c<d;c++)b.push(this.coincidents[c].ringIn);return b}},{key:"getRingsEntering",value:function a(){var b=[];for(var c=0,d=this.coincidents.length;c<d;c++){var e=this.coincidents[c];if(!e.sweepLineEntersRing)continue;b.push(e.ringIn)}return b}},{key:"getRingsExiting",value:function a(){var b=[];for(var c=0,d=this.coincidents.length;c<d;c++){var e=this.coincidents[c];if(e.sweepLineEntersRing)continue;b.push(e.ringIn)}return b}},{key:"getRingsEnteringAndExiting",value:function a(){var b=[],c=[];for(var d=0,e=this.coincidents.length;d<e;d++){var f=this.coincidents[d];f.sweepLineEntersRing?b.push(f.ringIn):c.push(f.ringIn)}return[b,c]}},{key:"_isValidEdgeForPoly",value:function a(){var b,c,d=this.getRingsEnteringAndExiting();this.sweepLineEntersRing?(b=d[0],c=d[1]):(c=d[0],b=d[1]);return this.ringIn.isValid(b,c,this.ringsInsideOf)}},{key:"getMultiPolysInsideOf",value:function a(){var b=[];for(var c=0,d=this.ringsInsideOf.length;c<d;c++){var e=this.ringsInsideOf[c].poly;if(b.includes(e.multiPoly))continue;if(!e.isInside(this.getRingsOnEdgeOf(),this.ringsInsideOf))continue;b.push(e.multiPoly)}return b}},{key:"getMultiPolysSLPEntersAndExits",value:function b(a){var c=a.slice(0),d=a.slice(0);for(var e=0,f=this.coincidents.length;e<f;e++){var g=this.coincidents[e],h=g.ringIn.poly.multiPoly;g.sweepLineEntersPoly?(c.includes(h)||c.push(h)):g.sweepLineExitsPoly&&(d.includes(h)||d.push(h))}return[c,d]}},{key:"_isInResult",value:function a(){if(this!==this.coincidents[0])return !1;var b=this.getMultiPolysInsideOf(),c=this.getMultiPolysSLPEntersAndExits(b),d=c[0],e=c[1];switch(cg.type){case cg.types.UNION:var k=d.length===0;var j=e.length===0;return k!==j;case cg.types.INTERSECTION:var i;var h;d.length<e.length?(i=d.length,h=e.length):(i=e.length,h=d.length);return h===cg.numMultiPolys&&i<h;case cg.types.XOR:var g=Math.abs(d.length-e.length);return g%2===1;case cg.types.DIFFERENCE:var f=function b(a){return a.length===1&&a[0].isSubject};return f(d)!==f(e);default:throw new Error("Unrecognized operation type found ".concat(cg.type))}}},{key:"_clearCache",value:function a(){this._cache={}}},{key:"bbox",get:function a(){var b=this.leftSE.point.y,c=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:b<c?b:c},ur:{x:this.rightSE.point.x,y:b>c?b:c}}}},{key:"vector",get:function a(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isVertical",get:function a(){return bR(this.leftSE.point.x,this.rightSE.point.x)===0}},{key:"prevInResult",get:function a(){var b='prevInResult';this._cache[b]===undefined&&(this._cache[b]=this["_".concat(b)]());return this._cache[b]}},{key:"prevNotCoincident",get:function a(){var b='prevNotCoincident';this._cache[b]===undefined&&(this._cache[b]=this["_".concat(b)]());return this._cache[b]}},{key:"sweepLineEntersRing",get:function a(){var b='sweepLineEntersRing';this._cache[b]===undefined&&(this._cache[b]=this["_".concat(b)]());return this._cache[b]}},{key:"sweepLineEntersPoly",get:function a(){if(!this.isValidEdgeForPoly)return !1;return this.ringIn.isExterior===this.sweepLineEntersRing}},{key:"sweepLineExitsPoly",get:function a(){if(!this.isValidEdgeForPoly)return !1;return this.ringIn.isExterior!==this.sweepLineEntersRing}},{key:"ringsInsideOf",get:function a(){var b='ringsInsideOf';this._cache[b]===undefined&&(this._cache[b]=this["_".concat(b)]());return this._cache[b]}},{key:"isValidEdgeForPoly",get:function a(){var b='isValidEdgeForPoly';this._cache[b]===undefined&&(this._cache[b]=this["_".concat(b)]());return this._cache[b]}},{key:"isInResult",get:function a(){var b='isInResult';this._cache[b]===undefined&&(this._cache[b]=this["_".concat(b)]());return this._cache[b]}}],[{key:"fromRing",value:function e(a,b,d){var f,g,h=bS(a,b);if(h<0)f=new ch(a),g=new ch(b);else if(h>0)f=new ch(b),g=new ch(a);else{throw new Error("Tried to create degenerate segment at [".concat(a.x,", ").concat(b.y,"]"))};return new c(f,g,d)}}]);return c}(),cn=0,co=function(){function a(b,c){f(this,a);this.id=cn++;this.poly=c;this.segments=[];var d=b[0];for(var e=1,g=b.length;e<g;e++){var h=b[e];this.segments.push(cm.fromRing(d,h,this));d=h}this.segments.push(cm.fromRing(d,b[0],this))}h(a,[{key:"getSweepEvents",value:function a(){var b=[];for(var c=0,d=this.segments.length;c<d;c++){var e=this.segments[c];b.push(e.leftSE);b.push(e.rightSE)}return b}},{key:"isValid",value:function d(a,b,c){var e=this.poly.exteriorRing,f=this.poly.interiorRings;if(this===e){for(var g=0,h=c.length;g<h;g++){if(f.includes(c[g]))return !1}for(var i=0,j=a.length;i<j;i++){if(f.includes(a[i]))return !1}return !0}if(!c.includes(e)){if(!b.includes(e))return !1}for(var k=0,l=c.length;k<l;k++){if(f.includes(c[k]))return !1}for(var m=0,n=b.length;m<n;m++){if(f.includes(b[m]))return !1}return !0}},{key:"isExterior",get:function a(){return this.poly.exteriorRing===this}},{key:"isInterior",get:function a(){return this.poly.exteriorRing!==this}}]);return a}(),cp=function(){function a(b,c){f(this,a);this.exteriorRing=new co(b[0],this);this.interiorRings=[];for(var d=1,e=b.length;d<e;d++)this.interiorRings.push(new co(b[d],this));this.multiPoly=c}h(a,[{key:"getSweepEvents",value:function a(){var b=this.exteriorRing.getSweepEvents();for(var c=0,d=this.interiorRings.length;c<d;c++){var e=this.interiorRings[c].getSweepEvents();for(var f=0,g=e.length;f<g;f++)b.push(e[f])}return b}},{key:"isInside",value:function c(a,b){for(var d=0,e=a.length;d<e;d++){if(a[d].poly===this)return !1}var f=!1;for(var g=0,h=b.length;g<h;g++){var i=b[g];if(i.poly!==this)continue;if(i.isInterior)return !1;f=!0}return f}}]);return a}(),cq=function(){function a(b){f(this,a);this.polys=[];for(var c=0,d=b.length;c<d;c++)this.polys.push(new cp(b[c],this));this.isSubject=!1}h(a,[{key:"markAsSubject",value:function a(){this.isSubject=!0}},{key:"getSweepEvents",value:function a(){var b=[];for(var c=0,d=this.polys.length;c<d;c++){var e=this.polys[c].getSweepEvents();for(var f=0,g=e.length;f<g;f++)b.push(e[f])}return b}}]);return a}(),cr=function(){h(a,null,[{key:"factory",value:function c(b){var d=[];for(var e=0,f=b.length;e<f;e++){var g=b[e];if(!g.isInResult||g.ringOut)continue;var h=null,i=g.leftSE,j=g.rightSE,k=[i],l=i.point,m=[];while(!0){h=i;i=j;k.push(i);if(i.point===l)break;while(!0){var n=i.getAvailableLinkedEvents();if(n.length===0){var o=k[0].point,p=k[k.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(o.x,",")+" ".concat(o.y,"]. Last matching segment found ends at")+" [".concat(p.x,", ").concat(p.y,"]."))}if(n.length===1){j=n[0].otherSE;break}var q=null;for(var r=0,s=m.length;r<s;r++){if(m[r].point===i.point){q=r;break}}if(q!==null){var t=m.splice(q)[0],u=k.splice(t.index);u.unshift(u[0].otherSE);d.push(new a(u.reverse()));continue}m.push({index:k.length,point:i.point});var v=i.getLeftmostComparator(h);j=n.sort(v)[0].otherSE;break}}d.push(new a(k))}return d}}]);function a(b){f(this,a);this.events=b;for(var c=0,d=b.length;c<d;c++)b[c].segment.registerRingOut(this);this.poly=null;this._clearCache()}h(a,[{key:"registerPoly",value:function b(a){this.poly=a}},{key:"getGeom",value:function a(){var b=[[this.events[0].point.x,this.events[0].point.y]];for(var c=1,d=this.events.length-1;c<d;c++){var e=this.events[c-1].point,f=this.events[c].point,g=this.events[c+1].point;if(bV(f,e,g)===0)continue;b.push([f.x,f.y])}var h=this.events[this.events.length-2].point,i=this.events[0].point,j=this.events[1].point;bV(i,h,j)===0&&b.shift();if(b.length===0)return null;b.push(b[0]);return this.isExteriorRing?b:b.reverse()}},{key:"_clearCache",value:function a(){this._cache={}}},{key:"_getCached",value:function c(a,b){this._cache[a]===undefined&&(this._cache[a]=this["_".concat(a)].bind(this)());return this._cache[a]}},{key:"_isExteriorRing",value:function a(){if(!this.enclosingRing)return !0;if(!this.enclosingRing.enclosingRing)return !1;return this.enclosingRing.enclosingRing.isExteriorRing}},{key:"_enclosingRing",value:function a(){var b=this.events[0];for(var c=1,d=this.events.length;c<d;c++){var e=this.events[c];ch.compare(b,e)>0&&(b=e)}var f=b.segment.prevInResult,g=f?f.prevInResult:null;while(!0){if(!f)return null;if(!g)return f.ringOut;if(g.ringOut!==f.ringOut){if(g.ringOut.enclosingRing!==f.ringOut){return f.ringOut}else return f.ringOut.enclosingRing}f=g.prevInResult;g=f?f.prevInResult:null}}},{key:"enclosingRing",get:function a(){return this._getCached('enclosingRing')}},{key:"isExteriorRing",get:function a(){return this._getCached('isExteriorRing')}}]);return a}(),cs=function(){function a(b){f(this,a);this.exteriorRing=b;b.registerPoly(this);this.interiorRings=[]}h(a,[{key:"addInterior",value:function b(a){this.interiorRings.push(a);a.registerPoly(this)}},{key:"getGeom",value:function a(){var b=[this.exteriorRing.getGeom()];if(b[0]===null)return null;for(var c=0,d=this.interiorRings.length;c<d;c++){var e=this.interiorRings[c].getGeom();if(e===null)continue;b.push(e)}return b}}]);return a}(),ct=function(){function a(b){f(this,a);this.rings=b;this.polys=this._composePolys(b)}h(a,[{key:"getGeom",value:function a(){var b=[];for(var c=0,d=this.polys.length;c<d;c++){var e=this.polys[c].getGeom();if(e===null)continue;b.push(e)}return b}},{key:"_composePolys",value:function b(a){var c=[];for(var d=0,e=a.length;d<e;d++){var f=a[d];if(f.poly)continue;f.isExteriorRing?c.push(new cs(f)):(f.enclosingRing.poly||c.push(new cs(f.enclosingRing)),f.enclosingRing.poly.addInterior(f))}return c}}]);return a}(),cu=function(){function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:cm.compare;f(this,a);this.tree=new bI(b);this.segments=[]}h(a,[{key:"process",value:function b(a){var c=a.segment,d=[],e=a.isLeft?this.tree.insert(c):this.tree.find(c),f=this.tree.prev(e),g=f?f.key:null,h=this.tree.next(e),i=h?h.key:null;if(a.isLeft){var j=[];if(g){var k=g.getIntersections(c);if(k.length>0){var l=this._possibleSplit(g,k);for(var m=0,n=l.length;m<n;m++)d.push(l[m]);for(var o=0,p=k.length;o<p;o++){var q=k[o];c.isAnEndpoint(q)||j.push(q)}}}if(i){var r=i.getIntersections(c);if(r.length>0){var s=this._possibleSplit(i,r);for(var t=0,u=s.length;t<u;t++)d.push(s[t]);for(var v=0,w=r.length;v<w;v++){var x=r[v];c.isAnEndpoint(x)||j.push(x)}}}if(d.length>0||j.length>0){this.tree.remove(c);if(j.length>0){var y=c.split(j);for(var z=0,A=y.length;z<A;z++)d.push(y[z])}d.push(a)}else this.segments.push(c),c.registerPrev(g)}else{if(g&&i){var B=g.getIntersections(i);if(B.length>0){var C=this._possibleSplit(g,B);for(var D=0,E=C.length;D<E;D++)d.push(C[D]);C=this._possibleSplit(i,B);for(var F=0,G=C.length;F<G;F++)d.push(C[F])}}this.tree.remove(c)}for(var H=0,I=d.length;H<I;H++){var J=d[H];J.isOrientationCorrect||J.segment.swapEvents()}return d}},{key:"_possibleSplit",value:function c(a,b){var d=[];for(var e=0,f=b.length;e<f;e++){var g=b[e];a.isAnEndpoint(g)||d.push(g)}var h=[];if(d.length>0){var i=[];for(var j=0,k=a.coincidents.length;j<k;j++){var l=this.tree.find(a.coincidents[j]);l!==null&&(i.push(l),this.tree.remove(l.key))}h=a.split(d);for(var m=0,n=i.length;m<n;m++)this.tree.insert(i[m].key)}return h}}]);return a}();function cv(a,b,c){var d=[cb(b)];for(var e=0,f=c.length;e<f;e++)d.push(cb(c[e]));for(var g=0,h=d.length;g<h;g++)cc(d[g]),cd(d[g]);var i=[];for(var j=0,k=d.length;j<k;j++)i.push(new cq(d[j]));i[0].markAsSubject();cg.register(a,i.length);var l=new bI(ch.compare);for(var m=0,n=i.length;m<n;m++){var o=i[m].getSweepEvents();for(var p=0,q=o.length;p<q;p++)l.insert(o[p])}var r=new cu(),s;while(s=l.pop()){var t=r.process(s.key);for(var u=0,v=t.length;u<v;u++)l.insert(t[u])}var w=cr.factory(r.segments),x=new ct(w);return x.getGeom()}var cw=function b(a){for(var c=arguments.length,d=new Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];return cv(cg.types.UNION,a,d)},cx=function b(a){for(var c=arguments.length,d=new Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];return cv(cg.types.INTERSECTION,a,d)},cy=function b(a){for(var c=arguments.length,d=new Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];return cv(cg.types.XOR,a,d)},cz=function b(a){for(var c=arguments.length,d=new Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];return cv(cg.types.DIFFERENCE,a,d)},cA={union:cw,intersection:cx,xor:cy,difference:cz};function cB(a,b,c,d){if(!a)throw new Error('geojson-buffer: Feature is required');if(b===undefined||b===null||isNaN(b))throw new Error('dgeojson-buffer: Distance is required');var e=a.type==='Feature'?a.geometry:a;if((e.type==='Point'||e.type==='MultiPoint'||e.type==='LineString'||e.type==='MultiLineString')&&b<0){throw new Error('geojson-buffer: If offsetting a point or linestring the distance must be positive')}var f=d||64,g=a.properties||{},h=s(b,c),i=null;switch(e.type){case 'Polygon':;case 'MultiPolygon':i=bv(e,h,f);break;case 'LineString':;case 'MultiLineString':i=bt(e,h,f);cC(i)&&(i=cA.union(i.geometry.coordinates),i=i.length===1?o(i[0]):q(i));break;case 'Point':i=by(e,h,f)};i.properties=g;return i}function cC(a){var b=aE(a);if(b.features.length>0)return !0;return !1}c.bufferGeoJSON=cB;Object.defineProperty(c,'__esModule',{value:!0})}))
